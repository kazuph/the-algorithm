<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Xã§ãƒã‚ºãŒç”Ÿã¾ã‚Œã‚‹ãƒ•ãƒ­ãƒ¼ â€” ã‚µã‚¤ãƒãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›³</title>
    <style>
      :root{
        --bg:#f6f8fc;
        --grid:#dfe3f4;
        --text:#1f2740;
        --muted:#5a6884;
        --neon-c1:#2b7de9;
        --neon-c2:#845ef7;
        --neon-c3:#f45d73;
        --neon-c4:#2fb47c;
        --warning:#f2a93b;
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:'Noto Sans JP', 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;line-height:1.6;}
      .wrap{display:grid;grid-template-columns:minmax(280px,320px) 1fr minmax(280px,320px);grid-template-rows:auto auto 1fr auto;gap:20px;min-height:100vh;height:100svh;padding:20px 24px;width:100%}
      header{grid-column:1/4;display:flex;gap:12px;align-items:center;justify-content:space-between}
      header h1{font-size:20px;letter-spacing:0.02em;margin:0;color:#16213f;text-shadow:none;font-weight:600}
      header .controls{display:flex;gap:8px;align-items:center}
      .seg.small button{padding:4px 8px;font-size:12px}
      .seg{display:inline-flex;border:1px solid #d1d8eb;border-radius:8px;overflow:hidden;background:#fff}
      .seg button{border:none;border-right:1px solid #d1d8eb;background:#f3f6ff;color:#314264;padding:6px 12px;cursor:pointer;font-size:13px;font-weight:500}
      .seg button:last-child{border-right:none}
      .seg button.on{background:#e8f1ff;color:#1f5fbf;box-shadow:inset 0 0 0 1px #95b8ff}
      .btn{background:#ffffff;border:1px solid #d1d8eb;color:#1f2740;padding:6px 12px;border-radius:8px;cursor:pointer;transition:.15s;box-shadow:0 1px 2px #0d1b2a14;font-size:13px;font-weight:500}
      .btn:hover{border-color:#95b8ff;box-shadow:0 2px 6px #6a7ca814;background:#f7faff}
      .btn.primary{border-color:var(--neon-c1);color:#1048a5;background:#e8f1ff;font-weight:600}
      .panel{background:#ffffff;border:1px solid #d1d8eb;box-shadow:0 6px 18px #101b3314;border-radius:14px;padding:16px}
      .left{grid-row:3/4;min-height:0;overflow:auto}
      .right{grid-row:3/4;min-height:0;overflow:auto}
      .legend h2, .phase h2{font-size:15px;margin:0 0 10px;color:#1f2740;font-weight:600}
      .legend ul{list-style:none;margin:0;padding:0;display:grid;gap:6px}
      .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid #d1d8eb;background:#f8faff;color:#1f2740;font-size:12px}
      .dot{width:10px;height:10px;border-radius:50%}
      .c1{background:var(--neon-c1);box-shadow:0 0 10px var(--neon-c1)}
      .c2{background:var(--neon-c2);box-shadow:0 0 10px var(--neon-c2)}
      .c3{background:var(--neon-c3);box-shadow:0 0 10px var(--neon-c3)}
      .c4{background:var(--neon-c4);box-shadow:0 0 10px var(--neon-c4)}
      .mut{color:var(--muted);font-size:12px}
      .phase p{margin:.45rem 0;color:#33415c}
      .buzz{margin-top:12px}
      .meter{height:180px;border:1px solid #d1d8eb;border-radius:10px;padding:6px;display:flex;align-items:flex-end;background:linear-gradient(180deg,#ffffff,#eef3fc)}
      .bar{width:100%;height:8%;background:linear-gradient(90deg,#4ba9ff,#9a6cff);box-shadow:0 2px 6px #4a6fff3d;border-radius:6px;transition: height .8s cubic-bezier(.2,.9,.2,1)}
      .meter .ticks{position:relative;inset:0}
      .meter .ticks::before{content:"";position:absolute;left:0;right:0;top:25%;height:1px;background:#ffffff11}
      .meter .ticks::after{content:"";position:absolute;left:0;right:0;top:60%;height:1px;background:#ffffff11}
      .muted{color:#5a6884}
      canvas#sim{grid-column:2/3;grid-row:3/4;width:100%;height:100%;min-height:0;border-radius:16px;border:1px solid #d1d8eb;background:linear-gradient(180deg,#ffffff,#eef3fc);box-shadow:inset 0 0 40px #dfe6f855}
      .gridOverlay{pointer-events:none;position:absolute;inset:0;border-radius:16px;overflow:hidden}
      .gridOverlay::before{content:"";position:absolute;inset:0;background-image:linear-gradient(transparent 31px,#c8d3ec 32px),linear-gradient(90deg,transparent 31px,#c8d3ec 32px);background-size:32px 32px;opacity:.2}
      .reader{margin-top:14px;border-top:1px solid #e1e7f4;padding-top:14px}
      .reader h3{margin:6px 0 6px;color:#1f2740;font-size:14px;font-weight:600}
      .reader p{margin:6px 0;color:#33415c;font-size:13px;line-height:1.6}
      .reader .tip{color:#5a6884;font-size:11px}
      .reader details{border:1px solid #d1d8eb;border-radius:10px;background:#ffffff;padding:10px 12px;margin:8px 0;box-shadow:0 4px 12px #101b3310}
      .reader summary{cursor:pointer;color:#1f2740;font-weight:600}
      .reader .kw{color:#2453b5;font-weight:600}
      .refs h2{font-size:14px;margin:10px 0 6px;color:#1f2740;font-weight:600}
      .refs ul{list-style:disc;margin:4px 0 8px 18px;padding:0;color:#33415c;font-size:12px}
      .refs li{margin:2px 0}
      .refs a{color:#2453b5}
      .signals{margin-top:12px}
      .signals h2{font-size:14px;margin:12px 0 6px;color:#1f2740;font-weight:600}
      .signals input{width:100%;background:#ffffff;border:1px solid #d1d8eb;border-radius:8px;color:#1f2740;padding:6px 8px;margin-bottom:6px}
      .sigItem{border:1px solid #d1d8eb;border-radius:10px;padding:8px;background:#f8faff;margin:6px 0}
      .sigItem .name{color:#1048a5;font-size:12px;font-weight:600}
      .sigItem .desc{color:#5a6884;font-size:11px;margin-top:2px}
      .sigItem .used{color:#33415c;font-size:11px;margin-top:4px}
      .attr h2{font-size:14px;margin:10px 0 6px;color:#1f2740;font-weight:600}
      .attr .row{display:flex;gap:6px;align-items:center}
      .attr .chip{justify-content:space-between}
      .attrBar{height:16px;border:1px solid #d1d8eb;border-radius:8px;display:flex;overflow:hidden;background:#eef3fc}
      .attrBar .pos{background:linear-gradient(90deg,#2fb47c,#4ba9ff);height:100%}
      .attrBar .neg{background:linear-gradient(90deg,#f45d73,#f2a93b);height:100%}
      .small{font-size:11px}
      /* code navigator modal */
      #codeNav{position:fixed;inset:0;background:rgba(24,36,68,.35);backdrop-filter:blur(6px);z-index:9;display:none}
      #codeNav .cWrap{position:absolute;left:50%;top:52%;transform:translate(-50%,-50%);width:min(1100px,92vw);height:min(70vh,780px);display:flex;flex-direction:column;gap:12px;background:#ffffff;border:1px solid #d1d8eb;border-radius:16px;box-shadow:0 18px 38px #0e1d3d1a;padding:18px}
      #codeNav .cHead{display:flex;gap:8px;align-items:center;color:#1f2740;font-weight:600}
      #codeNav .cBody{overflow:auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px;padding-right:4px}
      .mod{border:1px solid #d1d8eb;border-radius:12px;background:#f8faff;padding:12px}
      .mod h3{margin:0 0 6px;color:#1f2740;font-size:13px;font-weight:600}
      .mod ul{margin:0;padding-left:18px;font-size:12px;color:#33415c}
      .mod li{margin:3px 0}
      .mod code{color:#2453b5}
      .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
      .note{color:#5a6884;font-size:12px}
      .timeline{grid-column:1/4;grid-row:2/3;display:flex;gap:10px;align-items:center;position:sticky;top:10px;z-index:5}
      .timeline .phaseItem{flex:1;padding:8px 10px;border:1px solid #d1d8eb;border-radius:10px;background:#ffffff;position:relative;color:#33415c;box-shadow:0 2px 6px #0e1d3d12}
      .timeline .phaseItem.active{border-color:#95b8ff;box-shadow:0 8px 18px #3050c418;background:#f2f7ff;color:#1048a5}
      .timeline .phaseItem .glow{position:absolute;inset:0;border-radius:10px;background:radial-gradient(320px 60px at 50% 110%, rgba(59,107,246,.25) 0%, transparent 70%);opacity:0;transition:opacity .5s}
      .timeline .phaseItem.active .glow{opacity:.5}
      .timeline .phaseItem{cursor:pointer}
      .phaseFlash{pointer-events:none;position:fixed;inset:0;background:radial-gradient(circle at 50% 50%, rgba(59,107,246,.12), rgba(255,255,255,0) 45%);opacity:0;transition:opacity .6s}
      .phaseFlash.on{opacity:1}
      .phaseBadge{position:fixed;left:50%;top:14%;transform:translate(-50%,-50%);font-size:24px;letter-spacing:.08em;color:#1f2740;text-shadow:0 6px 18px #3050c41f;opacity:0;transition:opacity .6s;background:#ffffffeb;padding:6px 16px;border-radius:999px;border:1px solid #d1d8eb;box-shadow:0 12px 24px #0e1d3d14}
      .phaseBadge.on{opacity:1}
      .glitch{position:relative}
      .glitch::before,.glitch::after{content:attr(data-text);position:absolute;left:0;right:0;top:0;filter:blur(.4px);opacity:.35}
      .glitch::before{color:#845ef7;transform:translate(1.5px,0)}
      .glitch::after{color:#2b7de9;transform:translate(-1.5px,0)}
      #tip{position:fixed;pointer-events:none;z-index:10;max-width:360px;background:#ffffff;border:1px solid #d1d8eb;border-radius:12px;padding:10px 12px;color:#1f2740;box-shadow:0 12px 28px #0e1d3d1a}
      #tip .title{font-size:12px;color:#1048a5;margin-bottom:4px;font-weight:600}
      #tip .body{font-size:12px;line-height:1.55;color:#33415c}
      /* glossary modal */
      #glossary{position:fixed;inset:0;background:rgba(24,36,68,.35);backdrop-filter:blur(6px);z-index:9;display:none}
      #glossary .gWrap{position:absolute;left:50%;top:52%;transform:translate(-50%,-50%);width:min(1100px,92vw);height:min(70vh,780px);display:flex;flex-direction:column;gap:12px;background:#ffffff;border:1px solid #d1d8eb;border-radius:16px;box-shadow:0 18px 38px #0e1d3d1a;padding:18px}
      #glossary .gHead{display:flex;gap:8px;align-items:center;color:#1f2740;font-weight:600}
      #glossary .gHead input{flex:1;min-width:240px;background:#f8faff;border:1px solid #d1d8eb;border-radius:8px;color:#1f2740;padding:8px}
      #glossary .gBody{overflow:auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;padding-right:4px}
      .term{border:1px solid #d1d8eb;border-radius:12px;padding:12px;background:#f8faff}
      .term h3{margin:0 0 6px 0;font-size:14px;color:#1048a5;font-weight:600}
      .term p{margin:0;color:#33415c;font-size:12px;line-height:1.55}
      .term .meta{margin-top:6px;color:#5a6884;font-size:11px}
      footer{grid-column:1/4;color:#5a6884;opacity:1}
      footer a{color:#2453b5}
      .note{font-size:12px;line-height:1.5;margin-top:6px}
      .stack{display:flex;flex-direction:column;gap:6px}
      @media (max-width: 1080px){
        .wrap{grid-template-columns:1fr;grid-template-rows:auto auto 1fr auto auto}
        .left,.right,canvas#sim{grid-column:1/2}
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1 class="glitch" data-text="Xã§ãƒã‚ºãŒç”Ÿã¾ã‚Œã‚‹ãƒ•ãƒ­ãƒ¼">Xã§ãƒã‚ºãŒç”Ÿã¾ã‚Œã‚‹ãƒ•ãƒ­ãƒ¼ â€” ã‚µã‚¤ãƒãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
        <div class="controls">
          <button class="btn" id="btnPrev">â—€ï¸ å‰ã¸</button>
          <button class="btn primary" id="btnPlay">âµ å†ç”Ÿ</button>
          <button class="btn" id="btnNext">æ¬¡ã¸ â–¶ï¸</button>
          <button class="btn" id="btnReset">æœ€åˆã‹ã‚‰</button>
          <span class="mut">ãƒ¢ãƒ¼ãƒ‰:</span>
          <span class="seg" role="tablist" aria-label="è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰">
            <button class="on" id="modeForYou" role="tab" aria-selected="true">For You</button>
            <button id="modeFollowing" role="tab" aria-selected="false">Following</button>
            <button id="modePush" role="tab" aria-selected="false">é€šçŸ¥</button>
          </span>
          <span class="mut">ç”¨èª:</span>
          <span class="seg small" role="tablist" aria-label="ç”¨èªãƒ¬ãƒ™ãƒ«">
            <button class="on" id="vocabSimple" role="tab" aria-selected="true">ã‚„ã•ã—ã„è¡¨ç¤º</button>
            <button id="vocabExpert" role="tab" aria-selected="false">å°‚é–€ãƒ¢ãƒ¼ãƒ‰</button>
          </span>
          <button class="btn" id="btnGlossary">å˜èªå¸³</button>
          <button class="btn" id="btnCodeNav">ã‚³ãƒ¼ãƒ‰ãƒŠãƒ“</button>
          <button class="btn" id="btnSavePng">ğŸ–¼ PNGæ›¸ãå‡ºã—</button>
          <button class="btn" id="btnLayoutReset">â†º ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆæœŸåŒ–</button>
          <a class="btn" id="btnGitHub" href="https://github.com/kazuph/the-algorithm" target="_blank" rel="noopener">GitHub â†—ï¸</a>
        </div>
      </header>

      <aside class="panel left legend">
        <h2>å‡¡ä¾‹ / ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</h2>
        <ul class="stack">
          <li class="chip" id="legend-data"><span class="dot c1"></span> åå¿œã‚’é›†ã‚ã‚‹ç®±ï¼ˆUSS / UUAï¼‰</li>
          <li class="chip" id="legend-cand"><span class="dot c4"></span> å€™è£œã‚’é›†ã‚ã¦æ··ãœã‚‹ï¼ˆEarlybird / UTEG / CRâ€‘Mixer / FRSï¼‰</li>
          <li class="chip" id="legend-rank"><span class="dot c2"></span> ä¸€æ¬¡ãµã‚‹ã„ / æœ¬å¯©æŸ»ï¼ˆLight / Heavyï¼‰</li>
          <li class="chip" id="legend-mix"><span class="dot c3"></span> è¦‹ã›æ–¹ã¨ãƒ«ãƒ¼ãƒ«ï¼ˆHome Mixer / Visibilityï¼‰</li>
        </ul>
        <p class="mut note">ã“ã®å›³ã¯æœ¬ãƒªãƒã‚¸ãƒˆãƒªã® README ãªã©ã®å…¬é–‹æƒ…å ±ã«åŸºã¥ãæ¦‚å¿µã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚é‡ã¿ãƒ»é–¾å€¤ã¯å¯è¦–åŒ–ç›®çš„ã®æ“¬ä¼¼å€¤ã§ã™ã€‚</p>
        <div class="gridOverlay" aria-hidden="true"></div>
        <div class="reader" id="reader">
          <h2 style="font-size:14px;color:#1f2740;margin:4px 0 6px;font-weight:600">èª­ã¿ã‚‚ã®: ãƒã‚ºã‚‹ã¾ã§ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h2>
          <p class="tip">å„é …ç›®ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©²å½“ãƒ•ã‚§ãƒ¼ã‚ºã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™ã€‚</p>
          <details>
            <summary data-phase="1">1. æŠ•ç¨¿ï¼ˆãƒã‚¹ãƒˆï¼‰â€” èµ·ç‚¹ã‚’ã¤ãã‚‹</summary>
            <p>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒ <span class="kw">æŠ•ç¨¿</span> ã•ã‚Œã‚‹ã¨ã€ã™ãã«åˆæœŸã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ã§åå¿œé€Ÿåº¦ãŒè¦³æ¸¬ã•ã‚Œã¾ã™ã€‚çŸ­æ™‚é–“ã«ã€Œã„ã„ã­/RT/ã‚¯ãƒªãƒƒã‚¯/ãƒªãƒ—ãƒ©ã‚¤ã€ãŒé›†ã¾ã‚‹ã¨ã€<span class="kw">USSï¼ˆUser Signal Serviceï¼‰</span>ã¸å¼·ã„ä¿¡å·ã¨ã—ã¦è“„ç©ã•ã‚Œã€æ¬¡æ®µã®å€™è£œç”Ÿæˆã«æœ‰åˆ©ã«åƒãã¾ã™ã€‚</p>
            <p class="tip">åˆå‹•ã§ã€Œèª°ãŒã€åå¿œã™ã‚‹ã‹ã‚‚é‡è¦ã§ã™ã€‚è¿‘ç¸ã®ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‹ã‚‰ã®åå¿œã¯ <em>Inâ€‘Network ç¤¾ä¼šçš„è¨¼æ‹ </em> ã¨ã—ã¦åŠ¹ãç›®ãŒå¼·ããªã‚ŠãŒã¡ã§ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="2">2. åˆæœŸåå¿œï¼ˆUSSè“„ç©ï¼‰â€” åå¿œã®â€œè³ªã¨é€Ÿã•â€</summary>
            <p><span class="kw">USS</span> ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ã‚’çµ±ä¸€å½¢å¼ã§é›†ç´„ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€Œé‡ã€ã ã‘ã§ãªãã€Œé€Ÿã•ã€ã€Œå¤šæ§˜æ€§ã€ã€Œé–¢ä¿‚æ€§ï¼ˆRealGraph/SimClustersï¼‰ã€ãŒåŠ¹ãã€<span class="kw">Earlybirdï¼ˆæ¤œç´¢ï¼‰</span>ã€<span class="kw">UTEG</span>ã€<span class="kw">CRâ€‘Mixer</span>ã€<span class="kw">FRS</span> ã¸ä¿¡å·ãŒæµå…¥ã—ã¾ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="3">3. å€™è£œç”Ÿæˆï¼ˆCandidate Generationï¼‰â€” In/Outã®ä¸¡è¼ª</summary>
            <p><span class="kw">Earlybird</span> ã¯ä¸»ã« Inâ€‘Networkã€<span class="kw">UTEG</span> ã¯ç›¸äº’ä½œç”¨ã‚°ãƒ©ãƒ•ã‚’è¾¿ã‚‹ã“ã¨ã§ Outâ€‘ofâ€‘Network ã‚’åºƒã’ã€<span class="kw">CRâ€‘Mixer</span> ãŒæ··åˆã¨è»½ãƒ©ãƒ³ã‚¯ã‚’è¡Œã„ã¾ã™ã€‚<span class="kw">FRS</span> ã¯ãƒ•ã‚©ãƒ­ãƒ¼æ¨è–¦çµŒç”±ã®å€™è£œã‚’æ³¨å…¥ã—ã¾ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="4">4. ç‰¹å¾´é‡æ°´å’Œï¼ˆFeature Hydrationï¼‰â€” æ–‡è„ˆã‚’â€œç››ã‚‹â€</summary>
            <p>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«å¿…è¦ãª <span class="kw">~6000</span> ã®ç‰¹å¾´ã‚’å–å¾—ã—ã¾ã™ã€‚<span class="kw">Graph Feature Service</span> ã®ã‚°ãƒ©ãƒ•ç‰¹å¾´ã€<span class="kw">Representation Manager</span> ã®åŸ‹ã‚è¾¼ã¿ï¼ˆSimClusters/TwHIN ç­‰ï¼‰ã€å±¥æ­´ãƒ™ãƒ¼ã‚¹ã®çµ±è¨ˆãªã©ãŒä¾‹ã§ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="5">5. ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆLightâ†’Heavyï¼‰â€” å€™è£œã‚’çµã‚‹</summary>
            <p><span class="kw">Light Ranker</span> ãŒå¤§ã¾ã‹ã«é¸åˆ¥ã—ã€<span class="kw">Heavy Ranker</span> ãŒæœ¬æ ¼ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã‚’å®Ÿæ–½ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èˆˆå‘³ã«åˆã†é †ã«æ•´åˆ—ã•ã‚Œã¾ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="6">6. ãƒŸã‚­ã‚·ãƒ³ã‚°/åˆ¶å¾¡ï¼ˆHome Mixer/Visibilityï¼‰â€” è¦‹ã›æ–¹ã‚’æ•´ãˆã‚‹</summary>
            <p><span class="kw">Home Mixer</span> ãŒåºƒå‘Šã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨æ··åœ¨ã•ã›ã€<span class="kw">Visibility</span> ã§æ³•ä»¤ãƒ»å“è³ªãƒ»å®‰å…¨ã®è¦³ç‚¹ã‹ã‚‰è¡¨ç¤ºå‡¦ç†ï¼ˆéè¡¨ç¤º/ãƒ©ãƒ™ãƒ«/ãƒ€ã‚¦ãƒ³ãƒ©ãƒ³ã‚¯ï¼‰ã‚’é©ç”¨ã€‚<em>é‡è¤‡/æ—¢è¦–/ä½œè€…å¤šæ§˜æ€§/ç–²åŠ´</em> ã¨ã„ã£ãŸãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ã‚¯ã‚¹ã‚‚å‡¦ç†ã—ã¾ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="7">7. é…ä¿¡ï¼ˆFor You/é€šçŸ¥/Exploreï¼‰â€” é¢ã«å±Šã‘ã‚‹</summary>
            <p>å‡ºæ¥ä¸ŠãŒã£ãŸãƒªã‚¹ãƒˆãŒ <span class="kw">For You</span>ã€<span class="kw">é€šçŸ¥ï¼ˆPushserviceï¼‰</span>ã€<span class="kw">Explore</span> ãªã©ã¸é…ä¿¡ã€‚ã“ã“ã§ã®é–²è¦§ã‚„äºŒæ¬¡åå¿œãŒå†ã³ USS ã«æˆ»ã‚Šã€å¾ªç’°ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="8">8. æ³¢åŠï¼ˆå†å¾ªç’°ãƒ»æ‹¡æ•£ï¼‰â€” ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä¼ã†</summary>
            <p>åå¿œãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä¼æ’­ã™ã‚‹ã¨ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ï¼ˆ<span class="kw">SimClusters</span>ï¼‰ã‚’ã¾ãŸã„ã§è©±é¡ŒãŒç§»å‹•ã€‚<span class="kw">Topic Social Proof</span> ã«ã‚ˆã‚Šãƒˆãƒ”ãƒƒã‚¯æ–‡è„ˆã‚‚è£œå¼·ã•ã‚Œã¾ã™ã€‚</p>
          </details>
          <details>
            <summary data-phase="9">9. ãƒã‚ºç¢ºå®šï¼ˆè‡¨ç•Œï¼‰â€” è‡¨ç•Œç‚¹ã‚’è¶…ãˆã‚‹</summary>
            <p>éœ²å‡ºã¨åå¿œé€Ÿåº¦ãŒé–¾å€¤ã‚’è¶…ãˆã‚‹ã¨ã€æ‹¡æ•£ãŒè‡ªå·±ç¶­æŒçš„ã«é€²ã‚€ â€œè‡¨ç•Œâ€ ã«åˆ°é”ã€‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯å…‰æµå…¥ãŒæœ€å¤§åŒ–ã—ã¾ã™ã€‚</p>
          </details>
          <h3>ä¸ŠæŒ¯ã‚Œ/ä¸‹æŒ¯ã‚Œã®ä»£è¡¨ä¾‹</h3>
          <p>ä¸ŠæŒ¯ã‚Œ: åˆå‹•ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ã®é€Ÿã•ã€å¤šæ§˜ãªåå¿œç¨®åˆ¥ã€è¿‘ç¸ã‹ã‚‰ã®ç¤¾ä¼šçš„è¨¼æ‹ ã€è¦–è´ç¶­æŒï¼ˆå‹•ç”»/é•·æ–‡ï¼‰ã€ãƒˆãƒ”ãƒƒã‚¯é©åˆã€æ–°è¦æ€§ãªã©ã€‚</p>
          <p>ä¸‹æŒ¯ã‚Œ: é‡è¤‡/æ—¢èª­ã€ä½œè€…é€£æŠ•ã«ã‚ˆã‚‹å¤šæ§˜æ€§ä¸è¶³ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç–²åŠ´ã€ä½è©•ä¾¡ã®è“„ç©ã€å¯è¦–æ€§ãƒ©ãƒ™ãƒ«ï¼ˆæ³•ä»¤/å®‰å…¨ï¼‰ã€å¤–éƒ¨ãƒªãƒ³ã‚¯ã«ã‚ˆã‚‹é›¢è„±ï¼ˆä»®èª¬ï¼‰ã€‚</p>
          <p class="tip">å³ãƒ‘ãƒãƒ«ã€Œåˆ°é”å€ç‡ãƒ¢ãƒ‡ãƒ«ï¼ˆç°¡æ˜“ï¼‰ã€ã§ã€ã“ã‚Œã‚‰è¦å› ã‚’èª¿æ•´ã—ã¦éœ²å‡ºæ„Ÿã¸ã®å½±éŸ¿ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
          <details>
            <summary>FAQ / ã‚ˆãã‚ã‚‹èª¤è§£</summary>
            <p><strong>Q. Visibilityã¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãã®ã‚‚ã®ï¼Ÿ</strong><br/>A. ã„ã„ãˆã€‚Visibilityã¯â€œè¡¨ç¤ºæ™‚ã®æ‰±ã„â€ã‚’æ±ºã‚ã‚‹ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ³ã‚¸ãƒ³ã§ã€<em>éè¡¨ç¤º/ãƒ©ãƒ™ãƒ«/ã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ãƒ†ã‚£ã‚·ãƒ£ãƒ«/ãƒ€ã‚¦ãƒ³ãƒ©ãƒ³ã‚¯</em>ç­‰ã‚’æŒ‡ç¤ºã—ã¾ã™ã€‚é †ä½ä»˜ã‘è‡ªä½“ã¯ãƒ©ãƒ³ã‚«ãƒ¼ã§è¡Œã‚ã‚Œã¾ã™ã€‚</p>
            <p><strong>Q. TimelineRankerã¯é‡ãƒ©ãƒ³ã‚¯ã‚’ã™ã‚‹ï¼Ÿ</strong><br/>A. ã„ã„ãˆã€‚æ¤œç´¢ã‚¹ã‚³ã‚¢ç­‰ã‚’ç”¨ã„ãŸ<em>è»½ã„æ•´å½¢/ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</em>ãŒä¸­å¿ƒã§ã€Heavy Rankã¯Home Mixerå´ã®Scoringãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã™ã€‚</p>
            <p><strong>Q. Out-of-Networkã¯ä½•ã§ä½œã‚‰ã‚Œã‚‹ï¼Ÿ</strong><br/>A. UTEGï¼ˆå”èª¿ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ã€CRâ€‘Mixerï¼ˆæ··åˆ/è»½ãƒ©ãƒ³ã‚¯ï¼‰ã€FRSï¼ˆå°†æ¥ãƒ•ã‚©ãƒ­ãƒ¼è¦‹è¾¼ã¿ã®è‘—è€…ç”±æ¥ï¼‰ãªã©ã€‚Earlybirdã¯ä¸»ã«Inâ€‘Networkã‚’æ‹…å½“ã—ã¾ã™ã€‚</p>
            <p><strong>Q. å›ºå®šå€ç‡ã§ã‚¹ã‚³ã‚¢ã‚’æ±ºã‚ã¦ã„ã‚‹ï¼Ÿ</strong><br/>A. ã„ã„ãˆã€‚æœ¬ç•ªã¯å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ï¼ˆå¤šæ•°ã®ç‰¹å¾´ï¼‰ã¨ã‚ªãƒ³ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã®çµ„ã¿åˆã‚ã›ã§ã™ã€‚æœ¬æ•™æã®å€ç‡/å¯„ä¸UIã¯ç›´æ„Ÿå­¦ç¿’ç”¨ã®<em>ç©å…·</em>ã§ã™ã€‚</p>
          </details>
          <details>
            <summary>å­¦ç¿’ã®æ‰‹å¼•ã / èª­ã‚€é †åºã®ä¾‹</summary>
            <p>1) Home Mixerã®READMEâ†’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“åƒã€2) USS/UUAâ†’ä¿¡å·ã®å®Ÿä½“ã€3) å€™è£œç”Ÿæˆï¼ˆEarlybird/UTEG/CRâ€‘Mixer/FRSï¼‰â†’å…¥å£ã®å¤šæ§˜æ€§ã€4) ç‰¹å¾´é‡ï¼ˆGFS/RepMgr/RSXï¼‰â†’â€œç››ã‚Šä»˜ã‘â€ã€5) Visibilityâ†’è¡¨ç¤ºåˆ¶å¾¡ã€‚</p>
          </details>
        </div>
        <div class="signals">
          <h2>ã‚·ã‚°ãƒŠãƒ«æ¢ç´¢ï¼ˆCandidate Signalsï¼‰</h2>
          <input id="sigSearch" placeholder="signalåã‚„èª¬æ˜ã§æ¤œç´¢â€¦" />
          <div id="sigBody"></div>
          <div class="tip small">å‡ºå…¸: RETREIVAL_SIGNALS.mdï¼ˆæœ¬ãƒªãƒã‚¸ãƒˆãƒªï¼‰</div>
        </div>
      </aside>

      <canvas id="sim" aria-label="ãƒã‚ºç”Ÿæˆãƒ•ãƒ­ãƒ¼ã®ã‚µã‚¤ãƒãƒ¼é¢¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"></canvas>

      <aside class="panel right phase">
        <h2>ãƒ•ã‚§ãƒ¼ã‚ºèª¬æ˜</h2>
        <p id="phaseDesc" class="muted">å†ç”Ÿã‚’æŠ¼ã™ã¨ã€æŠ•ç¨¿ã‹ã‚‰ãƒã‚ºç¢ºå®šã¾ã§ã®æµã‚Œã‚’æ®µéšçš„ã«å¯è¦–åŒ–ã—ã¾ã™ã€‚å°‚é–€ç”¨èªã‚„ç•¥èªã¯ï¼ˆã‚«ãƒƒã‚³å†…ï¼‰ã«çŸ­ã„èª¬æ˜ã‚’ä½µè¨˜ã—ã¦ã„ã¾ã™ã€‚ãƒ•ã‚§ãƒ¼ã‚ºãŒé€²ã‚€ã»ã©å…‰ã®æµå…¥ãŒå¢—ã—ã¦ã„ãã¾ã™ã€‚</p>
        <div class="buzz">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span>ãƒã‚ºãƒ¡ãƒ¼ã‚¿ãƒ¼</span>
            <span id="buzzPercent" class="mut">8%</span>
          </div>
          <div class="meter"><div class="bar" id="buzzBar"></div><div class="ticks"></div></div>
        </div>
        <div class="note" style="margin-top:10px">
          å‚è€ƒ: <code>README.md</code>ã€<code>home-mixer/README.md</code>ã€<code>timelineranker/README.md</code>ã€<code>cr-mixer/README.md</code>ã€<code>user-signal-service/README.md</code>ã€<code>visibilitylib/README.md</code>ã€<code>RETREIVAL_SIGNALS.md</code>
        </div>
        <div id="phaseRefs" class="refs">
          <h2>ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’èª­ã‚€</h2>
          <ul id="phaseRefList"></ul>
        </div>
        <hr style="border:none;border-top:1px solid #d1d8eb;margin:10px 0"/>
        <h2>åˆ°é”å€ç‡ãƒ¢ãƒ‡ãƒ«ï¼ˆç°¡æ˜“ï¼‰</h2>
        <div id="multUI" class="mult">
          <div class="note">æ³¨æ„: å®Ÿéš›ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã§ã€å›ºå®šå€ç‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ¬UIã¯ãƒªãƒã‚¸ãƒˆãƒªè¨˜è¼‰ã®æ¦‚å¿µã‚’å…ƒã«ã—ãŸâ€œç©å…·ãƒ¢ãƒ‡ãƒ«â€ã§ã™ã€‚</div>
          <div style="margin:8px 0;display:grid;gap:8px">
            <div class="chip" style="justify-content:space-between">
              <span>ç¾åœ¨ã®åˆ°é”å€ç‡</span>
              <strong id="reachNow">1.00x</strong>
            </div>
            <div class="stack">
              <div style="font-size:12px;color:#5a6884">ä¸ŠæŒ¯ã‚Œè¦å› </div>
              <label>åˆå‹•ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸é€Ÿåº¦ <input type="range" min="1" max="3" step="0.1" value="1.2" data-factor="earlyVelocity"> <span class="mut" id="val-earlyVelocity">1.2x</span></label>
              <label>In-Networkç¤¾ä¼šçš„è¨¼æ‹  <input type="range" min="1" max="2.5" step="0.1" value="1.1" data-factor="socialProof"> <span class="mut" id="val-socialProof">1.1x</span></label>
              <label>ä½œè€…ã®ä¿¡é ¼åº¦/é–¢ä¿‚å¼·åº¦ <input type="range" min="1" max="1.8" step="0.1" value="1" data-factor="authorCred"> <span class="mut" id="val-authorCred">1.0x</span></label>
              <label>ãƒˆãƒ”ãƒƒã‚¯é©åˆï¼ˆé–¢å¿ƒä¸€è‡´ï¼‰ <input type="range" min="1" max="2" step="0.1" value="1" data-factor="topicFit"> <span class="mut" id="val-topicFit">1.0x</span></label>
              <label>è¦–è´ç¶­æŒ/æ»åœ¨ï¼ˆå‹•ç”»/é•·æ–‡ï¼‰ <input type="range" min="1" max="1.6" step="0.1" value="1" data-factor="dwell"> <span class="mut" id="val-dwell">1.0x</span></label>
              <label>æ–°è¦æ€§ãƒ–ãƒ¼ã‚¹ãƒˆï¼ˆæ—©æœŸï¼‰ <input type="range" min="1" max="1.3" step="0.05" value="1" data-factor="novelty"> <span class="mut" id="val-novelty">1.0x</span></label>
            </div>
            <div class="stack" style="margin-top:6px">
              <div style="font-size:12px;color:#5a6884">ä¸‹æŒ¯ã‚Œè¦å› </div>
              <label>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç–²åŠ´ <input type="range" min="0.6" max="1" step="0.05" value="1" data-factor="fatigue"> <span class="mut" id="val-fatigue">1.0x</span></label>
              <label>é‡è¤‡/æ—¢èª­ã®æŠ‘åˆ¶ <input type="range" min="0.2" max="1" step="0.05" value="1" data-factor="dedupe"> <span class="mut" id="val-dedupe">1.0x</span></label>
              <label>ä½œè€…å¤šæ§˜æ€§ã®åˆ¶å¾¡ <input type="range" min="0.6" max="1" step="0.05" value="1" data-factor="authorDivers"> <span class="mut" id="val-authorDivers">1.0x</span></label>
              <label>å®‰å…¨ãƒ©ãƒ™ãƒ«/å¯è¦–æ€§
                <select data-factor="safety">
                  <option value="1">ãªã— (1.0x)</option>
                  <option value="0.7">è»½ã„ãƒ©ãƒ™ãƒ« (0.7x)</option>
                  <option value="0.3">è­¦å‘Š/åˆ¶é™ (0.3x)</option>
                  <option value="0">éè¡¨ç¤º (0x)</option>
                </select>
              </label>
              <label>ä½è©•ä¾¡/èˆˆå‘³ãªã—ã®è“„ç© <input type="range" min="0.1" max="1" step="0.05" value="1" data-factor="negFeedback"> <span class="mut" id="val-negFeedback">1.0x</span></label>
              <label>å¤–éƒ¨ãƒªãƒ³ã‚¯é·ç§»ï¼ˆä»®èª¬ï¼‰ <input type="range" min="0.7" max="1" step="0.05" value="1" data-factor="outlink"> <span class="mut" id="val-outlink">1.0x</span></label>
              <div class="note">å¤–éƒ¨ãƒªãƒ³ã‚¯å½±éŸ¿ã¯æœ¬ãƒªãƒã‚¸ãƒˆãƒªã«å›ºå®šä¿‚æ•°ã¨ã—ã¦ã¯æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã“ã§ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³é›¢è„±ã®ä»®èª¬çš„è¦å› ã¨ã—ã¦ä»»æ„ã«æ“ä½œã§ãã¾ã™ã€‚</div>
            </div>
            <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px">
              <button class="btn" data-preset="text">ãƒ—ãƒªã‚»ãƒƒãƒˆ: ãƒ†ã‚­ã‚¹ãƒˆæŠ•ç¨¿</button>
              <button class="btn" data-preset="video">ãƒ—ãƒªã‚»ãƒƒãƒˆ: å‹•ç”»ï¼ˆé«˜ç¶­æŒï¼‰</button>
              <button class="btn" data-preset="link">ãƒ—ãƒªã‚»ãƒƒãƒˆ: å¤–éƒ¨ãƒªãƒ³ã‚¯è¨˜äº‹</button>
              <button class="btn" data-preset="thread">ãƒ—ãƒªã‚»ãƒƒãƒˆ: ã‚¹ãƒ¬ãƒƒãƒ‰</button>
              <button class="btn" data-preset="reset">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
          </div>
        </div>
        <div class="attr">
          <h2>ã‚¹ã‚³ã‚¢å¯„ä¸ï¼ˆç©å…·ï¼‰</h2>
          <div class="note">æ“¬ä¼¼çš„ãªå¯„ä¸ã®å¯è¦–åŒ–ã€‚å®Ÿéš›ã®ãƒ¢ãƒ‡ãƒ«ã¯å¤šæ•°ã®ç‰¹å¾´ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚</div>
          <div class="row" style="justify-content:space-between;margin:6px 0">
            <span>äºˆæ¸¬ã‚¹ã‚³ã‚¢</span>
            <strong id="attrScore">0.50</strong>
          </div>
          <div class="attrBar"><div id="attrPos" class="pos" style="width:50%"></div><div id="attrNeg" class="neg" style="width:0%"></div></div>
          <div class="stack" style="margin-top:8px">
            <label>ç¤¾ä¼šçš„è¨¼æ‹  <input type="range" min="0" max="3" step="0.1" value="1.2" data-w="w_sp"> <span class="mut" id="wval-w_sp">1.2</span></label>
            <label>é¡ä¼¼åº¦ï¼ˆåŸ‹ã‚è¾¼ã¿ï¼‰ <input type="range" min="0" max="3" step="0.1" value="1.1" data-w="w_sim"> <span class="mut" id="wval-w_sim">1.1</span></label>
            <label>è‘—è€…è¦ªå’Œï¼ˆRealGraphï¼‰ <input type="range" min="0" max="3" step="0.1" value="1.0" data-w="w_auth"> <span class="mut" id="wval-w_auth">1.0</span></label>
            <label>å†…å®¹å“è³ªï¼ˆProxyï¼‰ <input type="range" min="0" max="3" step="0.1" value="1.0" data-w="w_quality"> <span class="mut" id="wval-w_quality">1.0</span></label>
            <label>æ»åœ¨/è¦–è´ <input type="range" min="0" max="3" step="0.1" value="1.0" data-w="w_dwell"> <span class="mut" id="wval-w_dwell">1.0</span></label>
            <label>ãƒˆãƒ”ãƒƒã‚¯åˆè‡´ <input type="range" min="0" max="3" step="0.1" value="1.0" data-w="w_topic"> <span class="mut" id="wval-w_topic">1.0</span></label>
            <label>é®®åº¦ <input type="range" min="0" max="3" step="0.1" value="1.0" data-w="w_fresh"> <span class="mut" id="wval-w_fresh">1.0</span></label>
            <div class="row" style="margin-top:4px">
              <label>å¯è¦–æ€§/å®‰å…¨ãƒšãƒŠãƒ«ãƒ†ã‚£ <input type="range" min="0" max="1" step="0.05" value="0" data-w="p_safety"> <span class="mut" id="wval-p_safety">0.00</span></label>
              <label>ç–²åŠ´ãƒšãƒŠãƒ«ãƒ†ã‚£ <input type="range" min="0" max="0.4" step="0.02" value="0" data-w="p_fatigue"> <span class="mut" id="wval-p_fatigue">0.00</span></label>
              <label>é‡è¤‡ãƒšãƒŠãƒ«ãƒ†ã‚£ <input type="range" min="0" max="0.4" step="0.02" value="0" data-w="p_dedupe"> <span class="mut" id="wval-p_dedupe">0.00</span></label>
            </div>
            <div class="row" style="flex-wrap:wrap;margin-top:6px">
              <button class="btn" data-persona="sports">ãƒ—ãƒªã‚»ãƒƒãƒˆ: ã‚¹ãƒãƒ¼ãƒ„ãƒ•ã‚¡ãƒ³</button>
              <button class="btn" data-persona="tech">ãƒ—ãƒªã‚»ãƒƒãƒˆ: ãƒ†ãƒƒã‚¯</button>
              <button class="btn" data-persona="music">ãƒ—ãƒªã‚»ãƒƒãƒˆ: éŸ³æ¥½</button>
              <button class="btn" data-persona="reset">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <div class="note small" id="attrTop">Top drivers: ãƒ¼</div>
          </div>
        </div>
      </aside>

      <div class="timeline" id="timeline"></div>
      <div id="tip" style="display:none"><div class="title"></div><div class="body"></div></div>

      <div class="phaseFlash" id="phaseFlash" aria-hidden="true"></div>
      <div class="phaseBadge glitch" id="phaseBadge" data-text=""> </div>

      <!-- ç”¨èªå¸³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
      <div id="glossary" aria-modal="true" role="dialog" style="display:none">
        <div class="gWrap">
          <div class="gHead">
            <strong>ç”¨èªå¸³ï¼ˆGlossaryï¼‰</strong>
            <input id="gSearch" placeholder="ç”¨èªã‚„èª¬æ˜ã§æ¤œç´¢â€¦"/>
            <button class="btn" id="gClose">é–‰ã˜ã‚‹</button>
          </div>
          <div class="gBody" id="gBody"></div>
          <div class="note">æ³¨: ã“ã“ã«è¨˜è¼‰ã®èª¬æ˜ã¯æœ¬ãƒªãƒã‚¸ãƒˆãƒªã® README ç¾¤ã®å…¬é–‹æƒ…å ±ã‚’è¦ç´„ã—ãŸæ•™ç§‘æ›¸çš„è§£èª¬ã§ã™ã€‚å†…éƒ¨ä¿‚æ•°ãªã©ã¯å«ã¿ã¾ã›ã‚“ã€‚</div>
      </div>
      </div>

      <!-- ã‚³ãƒ¼ãƒ‰ãƒŠãƒ“ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
      <div id="codeNav" aria-modal="true" role="dialog" style="display:none">
        <div class="cWrap">
          <div class="cHead">
            <strong>ã‚³ãƒ¼ãƒ‰ãƒŠãƒ“ï¼ˆä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã¨READMEï¼‰</strong>
            <button class="btn" id="cClose">é–‰ã˜ã‚‹</button>
          </div>
          <div class="note">æ³¨: ãƒªãƒ³ã‚¯ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®ç›¸å¯¾ãƒ‘ã‚¹ï¼ˆä¾‹: <code>../home-mixer/README.md</code>ï¼‰ã¨GitHubã‚’ä½µè¨˜ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«è¡¨ç¤ºè¨­å®šã«ã‚ˆã‚Šé–‹ã‘ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</div>
          <div class="cBody" id="cBody"></div>
        </div>
      </div>

      <footer>
        <div class="note">
          - æœ¬ãƒšãƒ¼ã‚¸ã¯ 1 ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ¢ (index.html) ã§ã™ã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å‹•ä½œã—ã¾ã™ã€‚<br/>
          - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåã¯ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª/README ã«å¯¾å¿œ: Home Mixer, CR-Mixer, Earlybird(Search), UTEG, FRS, USS, Visibility ç­‰ã€‚
        </div>
      </footer>
    </div>

    <script>
    // ============= åŸºæœ¬ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =============
    const lerp = (a,b,t)=>a+(b-a)*t;
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const rand=(a,b)=>lerp(a,b,Math.random());

    // ============= ã‚­ãƒ£ãƒ³ãƒã‚¹åˆæœŸåŒ– =============
    const canvas = document.getElementById('sim');
    const ctx = canvas.getContext('2d');
    let W = 0, H = 0, DPR = Math.min(window.devicePixelRatio||1, 2);
    let layoutReady = false; // åˆæœŸresizeã§layoutæœªå®šç¾©ã‚’å›é¿
    function resize(){
      const rect = canvas.getBoundingClientRect();
      W = Math.floor(rect.width*DPR); H = Math.floor(Math.max(300,rect.height)*DPR);
      canvas.width = W; canvas.height = H; if(layoutReady) layout();
    }
    window.addEventListener('resize', resize);
    resize();

    // ============= ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ =============
    // ãƒãƒ¼ãƒ‰: ä½ç½®ã¯æ¯”ç‡ã§å®šç¾©ã—ã€ãƒªã‚µã‚¤ã‚ºã§å†è¨ˆç®—
    const nodes = [
      {id:'tweet', label:'æŠ•ç¨¿', color:'--neon-c1', pos:[0.08,0.52]},
      {id:'uss', label:'åå¿œã‚’é›†ã‚ã‚‹ç®±\n(ã„ã„ã­/è¿”ä¿¡ãªã©)', color:'--neon-c1', pos:[0.18,0.40]},

      {id:'earlybird', label:'ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‹ã‚‰æ‹¾ã†ä¿‚', color:'--neon-c4', pos:[0.32,0.26]},
      {id:'uteg', label:'ã¤ãªãŒã‚Šã‹ã‚‰æ‹¾ã†ä¿‚', color:'--neon-c4', pos:[0.33,0.50]},
      {id:'crmixer', label:'å€™è£œã‚’æ··ãœã‚‹ä¿‚', color:'--neon-c4', pos:[0.33,0.70]},
      {id:'frs', label:'ãƒ•ã‚©ãƒ­ãƒ¼é–¢é€£ã®å€™è£œ', color:'--neon-c4', pos:[0.24,0.82]},

      {id:'feat', label:'èƒŒæ™¯æƒ…å ±ã‚’è¶³ã™', color:'--neon-c1', pos:[0.48,0.46]},

      {id:'lightr', label:'ä¸€æ¬¡ãµã‚‹ã„', color:'--neon-c2', pos:[0.58,0.32]},
      {id:'heavyr', label:'æœ¬å¯©æŸ»', color:'--neon-c2', pos:[0.62,0.52]},

      {id:'mixer', label:'ç·¨é›†ãƒ‡ã‚¹ã‚¯', color:'--neon-c3', pos:[0.72,0.46]},
      {id:'filters', label:'ãƒ«ãƒ¼ãƒ«ã¨æ•´ç†', color:'--neon-c3', pos:[0.78,0.60]},

      {id:'distribution', label:'é…ã‚‹ï¼ˆå„ã‚¿ãƒ–ã¸ï¼‰', color:'--neon-c4', pos:[0.86,0.40]},
      {id:'users', label:'äººã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', color:'--neon-c1', pos:[0.86,0.70]},
      {id:'buzz', label:'ãƒã‚ºï¼ˆè‡¨ç•Œï¼‰', color:'--warning', pos:[0.94,0.50]},
    ];

    // ã‚¨ãƒƒã‚¸: src -> dst, æ›²ç·šåˆ¶å¾¡ç‚¹ä¿‚æ•°ã¨åŸºåº•å¼·åº¦
    const edgesBase = [
      ['tweet','uss', 0.2],
      ['uss','earlybird', 0.3],
      ['uss','uteg', 0.3],
      ['uss','crmixer', 0.2],
      ['uss','frs', 0.2],

      ['earlybird','lightr', 0.4],
      ['uteg','lightr', 0.35],
      ['crmixer','lightr', 0.25],
      ['frs','lightr', 0.2],
      ['lightr','feat', 0.25],
      ['feat','heavyr', 0.45],
      ['heavyr','mixer', 0.55],
      ['mixer','filters', 0.65],
      ['filters','distribution', 0.55],
      ['distribution','users', 0.45],
      ['users','buzz', 0.35],
      // åéŸ¿ãƒ«ãƒ¼ãƒ—
      ['users','uss', 0.1],
      ['buzz','distribution', 0.15],
    ];

    // ãƒ¢ãƒ¼ãƒ‰ï¼ˆFor You / Following / é€šçŸ¥ï¼‰
    let currentMode = 'foryou';
    const modeBoosts = {
      foryou: {
        title: 'For You',
        edges: new Set([
          'uss->earlybird','uss->uteg','uss->crmixer','uss->frs',
          'earlybird->lightr','uteg->lightr','crmixer->lightr','frs->lightr',
          'lightr->feat','feat->heavyr','heavyr->mixer','mixer->filters','filters->distribution'
        ]),
        k: 1.15
      },
      following: {
        title: 'Following',
        edges: new Set([
          'uss->earlybird','earlybird->lightr','lightr->feat','feat->heavyr','heavyr->mixer','mixer->filters','filters->distribution'
        ]),
        k: 1.15
      },
      push: {
        title: 'é€šçŸ¥',
        edges: new Set([
          'uss->crmixer','crmixer->lightr','lightr->feat','feat->heavyr','mixer->filters','filters->distribution','distribution->users'
        ]),
        k: 1.12
      }
    };

    const nodeMap = new Map();
    const edges = [];
    function layout(){
      nodeMap.clear();
      for(const n of nodes){
        const x = n.pos[0]*W; const y = n.pos[1]*H; n.x=x; n.y=y; nodeMap.set(n.id,n);
      }
      edges.length=0;
      for(const [a,b,str] of edgesBase){
        const A=nodeMap.get(a), B=nodeMap.get(b);
        const midX = (A.x+B.x)/2 + (B.y-A.y)*0.05; // å°‘ã—æ¹¾æ›²
        const midY = (A.y+B.y)/2 + (A.x-B.x)*0.02;
        edges.push({a:A,b:B,cx:midX,cy:midY,base:str,intensity:str});
      }
      layoutReady = true;
    }
    layout();

    // ============= ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ  =============
    // ãƒãƒ¼ãƒ‰èª¬æ˜ï¼ˆã‚„ã•ã—ã„/å°‚é–€ï¼‰
    const nodeInfoExpert = {
      tweet:'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–°è¦æŠ•ç¨¿ã€‚ãƒ†ã‚­ã‚¹ãƒˆ/ç”»åƒ/å‹•ç”»/ãƒªãƒ³ã‚¯ãªã©ãŒèµ·ç‚¹ã€‚',
      uss:'User Signal Service: ã„ã„ã­/RT/è¿”ä¿¡/ã‚¯ãƒªãƒƒã‚¯/è¦–è´/ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨ªå•ãªã©ã®ä¿¡å·ã‚’é›†ç´„ã—çµ±ä¸€å½¢å¼ã§æä¾›ã€‚',
      earlybird:'æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹(Earlybird)ã€‚ä¸»ã«In-Networkã‹ã‚‰é«˜é€Ÿã«å€™è£œã‚’å–å¾—ã€‚',
      uteg:'User Tweet Entity Graphã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼Ã—ãƒ„ã‚¤ãƒ¼ãƒˆã®ç›¸äº’ä½œç”¨ã‚°ãƒ©ãƒ•ã‚’è¾¿ã£ã¦å€™è£œã‚’æ¢ç´¢ã€‚',
      crmixer:'CRâ€‘Mixerã€‚è¤‡æ•°å€™è£œæºã‚’æ··åˆã—è»½ãƒ©ãƒ³ã‚¯/ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨ã€‚',
      frs:'Follow Recommendations Serviceã€‚ãƒ•ã‚©ãƒ­ãƒ¼æ¨è–¦çµŒç”±ã®å€™è£œæ³¨å…¥ã€‚',
      feat:'ç‰¹å¾´é‡æ°´å’Œã€‚Graph Feature/Representation Managerç­‰ã‹ã‚‰å¤šæ•°ã®ç‰¹å¾´ã‚’å–å¾—ã€‚',
      lightr:'Light Rankerã€‚äºˆé¸æ®µéšã®è»½é‡ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã€‚',
      heavyr:'Heavy Rankerã€‚ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹æœ¬ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€‚',
      mixer:'Home Mixerã€‚æœ€çµ‚ä¸¦ã¹æ›¿ãˆ/éãƒ„ã‚¤ãƒ¼ãƒˆè¦ç´ ã®æ··åœ¨/ã‚«ãƒ¼ã‚½ãƒ«ç­‰ã€‚',
      filters:'Visibility/ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ã‚¯ã‚¹ã€‚æ³•ä»¤/å“è³ª/ä¿¡é ¼/åç›Šä¿è­·ã€é‡è¤‡/æ—¢è¦–/ç–²åŠ´ãªã©ã®åˆ¶å¾¡ã€‚',
      distribution:'é…ä¿¡ã€‚For You/é€šçŸ¥/Exploreãªã©ã®é¢ã¸éœ²å‡ºã€‚',
      users:'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯(RealGraph/SimClusters)ã€‚äºŒæ¬¡åå¿œãƒ»æ‹¡æ•£æºã€‚',
      buzz:'ãƒã‚ºçŠ¶æ…‹ã€‚éœ²å‡ºã¨åå¿œãŒè‡¨ç•Œã«é”ã—ãŸçµæœã€‚'
    };
    const nodeInfoSimple = {
      tweet:'æ–°ã—ã„æŠ•ç¨¿ãŒç”Ÿã¾ã‚Œã‚‹å ´æ‰€ã€‚',
      uss:'ã„ã„ã­/ãƒªãƒã‚¹ãƒˆ/è¿”ä¿¡/ã‚¯ãƒªãƒƒã‚¯ãªã©ã€åå¿œã‚’ã²ã¨ã¤ã«é›†ã‚ã‚‹ç®±ã€‚',
      earlybird:'ãƒ•ã‚©ãƒ­ãƒ¼é–¢ä¿‚ã‚’ä¸­å¿ƒã«ã€å€™è£œã®æŠ•ç¨¿ã‚’ã™ã°ã‚„ãæ‹¾ã†ä¿‚ã€‚',
      uteg:'ã€Œé–¢ä¿‚ãŒè¿‘ã„äººãŸã¡ã€ã®è¡Œå‹•ã‹ã‚‰å€™è£œã‚’åºƒã’ã‚‹ä¿‚ã€‚',
      crmixer:'ã„ã‚ã„ã‚ãªå€™è£œã‚’æ··ãœã¦ã€è»½ã„ãµã‚‹ã„ã«ã‹ã‘ã‚‹ä¿‚ã€‚',
      frs:'ãƒ•ã‚©ãƒ­ãƒ¼é–¢é€£ã®æƒ…å ±ã‹ã‚‰ã€å‡ºã—ã©ã“ã‚ã‚’å¢—ã‚„ã™ä¿‚ã€‚',
      feat:'æŠ•ç¨¿ã‚„ä½œè€…ã®èƒŒæ™¯æƒ…å ±ã‚’é›†ã‚ã¦ã€æ–‡è„ˆã‚’è¶³ã™å·¥ç¨‹ã€‚',
      lightr:'å¤§ã¾ã‹ã«è‰¯ã•ãã†ãªã‚‚ã®ã‚’é¸ã¶ä¸€æ¬¡ãµã‚‹ã„ã€‚',
      heavyr:'æ©Ÿæ¢°å­¦ç¿’ã§ã—ã£ã‹ã‚Šæ¡ç‚¹ã™ã‚‹æœ¬å¯©æŸ»ã€‚',
      mixer:'å…¨ä½“ã®è¦‹ã›æ–¹ã‚’æ•´ãˆã‚‹ç·¨é›†ãƒ‡ã‚¹ã‚¯ã€‚',
      filters:'é‡è¤‡/è¦‹é£½ã/å®‰å…¨ãªã©ã®ãƒ«ãƒ¼ãƒ«ã§æ•´ç†ã™ã‚‹ã€‚',
      distribution:'For Youãƒ»é€šçŸ¥ãƒ»ç™ºè¦‹ãªã©ã€å‡ºã™å ´æ‰€ã«å±Šã‘ã‚‹ã€‚',
      users:'äººã¨äººã®ã¤ãªãŒã‚Šã€‚åå¿œãŒæ¬¡ã®äººã¸ä¼ã‚ã‚‹åœŸå°ã€‚',
      buzz:'åå¿œãŒé€£é–ã—ã¦ã€åºƒãŒã‚ŠãŒæ­¢ã¾ã‚Šã«ãããªã£ãŸçŠ¶æ…‹ã€‚'
    };
    let nodeInfo = nodeInfoSimple;
    const particles=[];
    function spawnOnEdge(e, k=1){
      const t0 = Math.random()*0.2; // ãƒ©ãƒ³ãƒ€ãƒ ä½ç½®
      const speed = rand(0.15,0.6); // ã‚¨ãƒƒã‚¸å›ºæœ‰é€Ÿåº¦
      particles.push({e, t:t0, v: speed*(0.3+e.intensity), life:rand(0.8,1.6), hue: rand(180,220)});
    }
    function edgePoint(e,t){
      const x = (1-t)*(1-t)*e.a.x + 2*(1-t)*t*e.cx + t*t*e.b.x;
      const y = (1-t)*(1-t)*e.a.y + 2*(1-t)*t*e.cy + t*t*e.b.y;
      return {x,y};
    }

    // ============= ãƒ•ã‚§ãƒ¼ã‚ºå®šç¾©ï¼ˆã‚„ã•ã—ã„/å°‚é–€ï¼‰ =============
    const phasesSimple = [
      {name:'æº–å‚™', key:'init', desc:'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™ã€‚æç”»ã®ä¸‹ã”ã—ã‚‰ãˆã‚’ã—ã¾ã™ã€‚', boost: {all:0.3}},
      {name:'æŠ•ç¨¿ãŒç”Ÿã¾ã‚Œã‚‹', key:'post', desc:'ã ã‚Œã‹ãŒæŠ•ç¨¿ã€‚æœ€åˆã®åå¿œãŒã€Œåå¿œã®ç®±ã€ã«å…¥ã‚Šå§‹ã‚ã¾ã™ã€‚',
        boost:{ edges:['tweet->uss'], amount:2.2 } },
      {name:'æœ€åˆã®åå¿œãŒé›†ã¾ã‚‹', key:'early', desc:'ã„ã„ã­/ãƒªãƒã‚¹ãƒˆ/è¿”ä¿¡/ã‚¯ãƒªãƒƒã‚¯ãªã©ã®åå¿œãŒé›†ã¾ã‚Šã€ã¤ãªãŒã‚Šæƒ…å ±ã‚‚æ´»æ€§åŒ–ã—ã¾ã™ã€‚',
        boost:{ edges:['uss->earlybird','uss->uteg','uss->crmixer','uss->frs'], amount:1.6 } },
      {name:'å€™è£œã‚’ã‹ãé›†ã‚ã‚‹', key:'cand', desc:'ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼å´/é–¢ä¿‚ã®è¿‘ã„äººå´ãªã©ã‹ã‚‰æŠ•ç¨¿å€™è£œã‚’åºƒãé›†ã‚ã€ã¾ãšæ··ãœã¾ã™ã€‚',
        boost:{ edges:['earlybird->lightr','uteg->lightr','crmixer->lightr','frs->lightr'], amount:1.8 } },
      {name:'èƒŒæ™¯æƒ…å ±ã‚’è¶³ã™', key:'feat', desc:'ä½œè€…ã‚„å†…å®¹ã®èƒŒæ™¯ã€é–¢å¿ƒã®è¿‘ã•ãªã©å¤šãã®æƒ…å ±ã‚’é›†ã‚ã€åˆ¤æ–­ææ–™ã‚’ãã‚ãˆã¾ã™ã€‚',
        boost:{ edges:['lightr->feat'], amount:1.8 } },
      {name:'ç‚¹æ•°ã‚’ã¤ã‘ã‚‹', key:'rank', desc:'è»½ã„ãµã‚‹ã„ã§çµã£ã¦ã‹ã‚‰ã€æ©Ÿæ¢°å­¦ç¿’ã§æœ¬æ ¼çš„ã«æ¡ç‚¹ã—ã¾ã™ã€‚',
        boost:{ edges:['feat->heavyr','heavyr->mixer'], amount:2.0 } },
      {name:'ä¸¦ã¹æ›¿ãˆã¨ãƒ«ãƒ¼ãƒ«', key:'mix', desc:'åŒã˜ä½œè€…ã®é€£ç¶šã‚„é‡è¤‡ã€è¦‹é£½ãã€å®‰å…¨é…æ…®ãªã©ã®ãƒ«ãƒ¼ãƒ«ã‚’å½“ã¦ã¾ã™ã€‚',
        boost:{ edges:['mixer->filters'], amount:2.0 } },
      {name:'é…ã‚‹', key:'dist', desc:'For Youãƒ»é€šçŸ¥ãƒ»ç™ºè¦‹ãªã©ã®é¢ã«å±Šã‘ã€æ¬¡ã®åå¿œã¸ã¤ãªã’ã¾ã™ã€‚',
        boost:{ edges:['filters->distribution','distribution->users'], amount:2.3 } },
      {name:'åºƒãŒã‚‹', key:'spread', desc:'äººã®ã¤ãªãŒã‚Šã‚’ä¼ã£ã¦åºƒãŒã‚Šã€è©±é¡ŒãŒç§»å‹•ã—ã¾ã™ã€‚',
        boost:{ edges:['users->buzz','users->uss','buzz->distribution'], amount:2.5 } },
      {name:'ãƒã‚ºã«è‡³ã‚‹', key:'buzz', desc:'åå¿œãŒé€£é–ã—ã‚„ã™ããªã‚Šã€åºƒãŒã‚ŠãŒåŠ é€Ÿã—ãŸçŠ¶æ…‹ã§ã™ã€‚',
        boost:{ all:3.4 } },
    ];

    const phasesExpert = [
      {name:'æº–å‚™ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ï¼‰', key:'init', desc:'ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™æ®µéšã€‚èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰ã‚„åŸºç¤å…‰ã‚’ç”Ÿæˆã€‚ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æŠ•ç¨¿ã‚¤ãƒ™ãƒ³ãƒˆãã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚', boost: {all:0.3}},
      {name:'æŠ•ç¨¿ï¼ˆãƒã‚¹ãƒˆï¼‰', key:'post', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ–°è¦æŠ•ç¨¿ã€‚USSï¼ˆUser Signal Serviceï¼‰ã«åˆæœŸä¿¡å·ãŒæµã‚Œå§‹ã‚ã¾ã™ã€‚',
        boost:{ edges:['tweet->uss'], amount:2.2 } },
      {name:'åˆæœŸåå¿œï¼ˆUSSè“„ç©ï¼‰', key:'early', desc:'ã„ã„ã­/RT/ã‚¯ãƒªãƒƒã‚¯ç­‰ãŒUSSã«è“„ç©ã€‚RealGraph/SimClustersï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ç‰¹å¾´ï¼‰ãŒæ´»æ€§åŒ–ã€‚',
        boost:{ edges:['uss->earlybird','uss->uteg','uss->crmixer','uss->frs'], amount:1.6 } },
      {name:'å€™è£œç”Ÿæˆï¼ˆCandidate Generationï¼‰', key:'cand', desc:'In/Out-of-Networkã®å€™è£œåé›†ã€‚CRâ€‘Mixerã§è»½ãƒ©ãƒ³ã‚¯ã¨æ··åˆã€‚',
        boost:{ edges:['earlybird->lightr','uteg->lightr','crmixer->lightr','frs->lightr'], amount:1.8 } },
      {name:'ç‰¹å¾´é‡æ°´å’Œï¼ˆFeature Hydrationï¼‰', key:'feat', desc:'~6000ç¨®ã®ç‰¹å¾´ã‚’æ°´å’Œï¼ˆGraph Feature/RepMgrãªã©ï¼‰ã€‚ãƒ©ãƒ³ã‚¯ç”¨ã®æ–‡è„ˆã‚’å¼·åŒ–ã€‚',
        boost:{ edges:['lightr->feat'], amount:1.8 } },
      {name:'ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆLight/Heavy Rankerï¼‰', key:'rank', desc:'è»½é‡â†’é‡é‡ãƒ©ãƒ³ã‚«ãƒ¼ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã€‚è‰¯è³ªå€™è£œã‚’é›†ç´„ã€‚',
        boost:{ edges:['feat->heavyr','heavyr->mixer'], amount:2.0 } },
      {name:'ãƒŸã‚­ã‚·ãƒ³ã‚°/åˆ¶å¾¡ï¼ˆHome Mixerãƒ»Visibilityï¼‰', key:'mix', desc:'Home Mixerã§ä¸¦ã¹æ›¿ãˆã€‚Visibility/é‡è¤‡/ç–²åŠ´/æ³•ä»¤ç­‰ã‚’èª¿æ•´ã€‚',
        boost:{ edges:['mixer->filters'], amount:2.0 } },
      {name:'é…ä¿¡ï¼ˆFor Youãƒ»é€šçŸ¥ç­‰ï¼‰', key:'dist', desc:'For Youãƒ»é€šçŸ¥ãƒ»Explore ãªã©ã«é…ä¿¡ã€‚é–²è¦§â†’äºŒæ¬¡åå¿œã¸ã€‚',
        boost:{ edges:['filters->distribution','distribution->users'], amount:2.3 } },
      {name:'æ³¢åŠï¼ˆå†å¾ªç’°ãƒ»æ‹¡æ•£ï¼‰', key:'spread', desc:'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä¼æ’­ã€‚ãƒˆãƒ¬ãƒ³ãƒ‰/è©±é¡Œæ€§ãŒä¸Šæ˜‡ã—å†å¾ªç’°ã€‚',
        boost:{ edges:['users->buzz','users->uss','buzz->distribution'], amount:2.5 } },
      {name:'ãƒã‚ºç¢ºå®šï¼ˆè‡¨ç•Œåˆ°é”ï¼‰', key:'buzz', desc:'æ‹¡æ•£é€Ÿåº¦ãŒè‡¨ç•Œã«åˆ°é”ã—ã€å…‰ã®æµå…¥ãŒæœ€å¤§åŒ–ã€‚',
        boost:{ all:3.4 } },
    ];

    let phases = phasesSimple; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€Œã‚„ã•ã—ã„ã€

    // ãƒãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«ã¨å‡¡ä¾‹ãƒ†ã‚­ã‚¹ãƒˆï¼ˆã‚„ã•ã—ã„/å°‚é–€ï¼‰
    const nodeLabels = {
      simple: {
        tweet:'æŠ•ç¨¿',
        uss:'åå¿œã‚’é›†ã‚ã‚‹ç®±\n(ã„ã„ã­/è¿”ä¿¡ãªã©)',
        earlybird:'ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã‹ã‚‰æ‹¾ã†ä¿‚',
        uteg:'ã¤ãªãŒã‚Šã‹ã‚‰æ‹¾ã†ä¿‚',
        crmixer:'å€™è£œã‚’æ··ãœã‚‹ä¿‚',
        frs:'ãƒ•ã‚©ãƒ­ãƒ¼é–¢é€£ã®å€™è£œ',
        feat:'èƒŒæ™¯æƒ…å ±ã‚’è¶³ã™',
        lightr:'ä¸€æ¬¡ãµã‚‹ã„',
        heavyr:'æœ¬å¯©æŸ»',
        mixer:'ç·¨é›†ãƒ‡ã‚¹ã‚¯',
        filters:'ãƒ«ãƒ¼ãƒ«ã¨æ•´ç†',
        distribution:'é…ã‚‹ï¼ˆå„ã‚¿ãƒ–ã¸ï¼‰',
        users:'äººã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯',
        buzz:'ãƒã‚ºï¼ˆè‡¨ç•Œï¼‰'
      },
      expert: {
        tweet:'æŠ•ç¨¿ï¼ˆãƒã‚¹ãƒˆï¼‰',
        uss:'USSï¼ˆUser Signal Serviceï¼‰\nãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ä¿¡å·',
        earlybird:'Earlybirdï¼ˆæ¤œç´¢ï¼‰\nIn-Networkå€™è£œ',
        uteg:'UTEGï¼ˆUser Tweet\nEntity Graphï¼‰',
        crmixer:'CRâ€‘Mixerï¼ˆå€™è£œæ··åˆ/è»½ãƒ©ãƒ³ã‚¯ï¼‰',
        frs:'FRSï¼ˆFollow\nRecommendationsï¼‰',
        feat:'ç‰¹å¾´é‡æ°´å’Œï¼ˆ~6000ï¼‰\nGraph Feature/RepMgr',
        lightr:'Light Rankerï¼ˆè»½ï¼‰',
        heavyr:'Heavy Rankerï¼ˆé‡ï¼‰',
        mixer:'Home Mixerï¼ˆçµ±åˆï¼‰',
        filters:'Visibilityï¼ˆå¯è¦–æ€§ï¼‰\né‡è¤‡/ç–²åŠ´/æ³•ä»¤ç­‰',
        distribution:'é…ä¿¡ï¼ˆFor You/é€šçŸ¥/Exploreï¼‰',
        users:'RealGraph/SimClusters\nï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰',
        buzz:'ãƒã‚ºï¼ˆè‡¨ç•Œï¼‰'
      }
    };

    const legendText = {
      simple: {
        data: 'åå¿œã‚’é›†ã‚ã‚‹ç®±ï¼ˆUSS / UUAï¼‰',
        cand: 'å€™è£œã‚’é›†ã‚ã¦æ··ãœã‚‹ï¼ˆEarlybird / UTEG / CRâ€‘Mixer / FRSï¼‰',
        rank: 'ä¸€æ¬¡ãµã‚‹ã„ / æœ¬å¯©æŸ»ï¼ˆLight / Heavyï¼‰',
        mix: 'è¦‹ã›æ–¹ã¨ãƒ«ãƒ¼ãƒ«ï¼ˆHome Mixer / Visibilityï¼‰'
      },
      expert: {
        data: 'ãƒ‡ãƒ¼ã‚¿/ä¿¡å·: USSï¼ˆUser Signal Serviceï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ä¿¡å·ã®é›†ç´„ï¼‰ãƒ»UUA ç­‰',
        cand: 'å€™è£œç”Ÿæˆ: Earlybirdï¼ˆæ¤œç´¢ï¼‰, UTEGï¼ˆUser Tweet Entity Graphï¼‰, CRâ€‘Mixer, FRSï¼ˆFollow Recommendations Serviceï¼‰',
        rank: 'ãƒ©ãƒ³ã‚­ãƒ³ã‚°: Light Rankerï¼ˆè»½ï¼‰/ Heavy Rankerï¼ˆé‡ï¼‰',
        mix: 'ãƒŸã‚­ã‚·ãƒ³ã‚°/åˆ¶å¾¡: Home Mixerï¼ˆçµ±åˆï¼‰, Visibilityï¼ˆå¯è¦–æ€§ï¼‰, ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ã‚¯ã‚¹'
      }
    };

    let phaseIndex = 0; let playing=false; let phaseTimer=0; let phaseDur=4500; // ms
    const badge = document.getElementById('phaseBadge');
    const flash = document.getElementById('phaseFlash');
    const phaseDesc = document.getElementById('phaseDesc');

    // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³UI
    const tl = document.getElementById('timeline');
    const reader = document.getElementById('reader');
    let items = [];
    function buildTimeline(){
      tl.innerHTML = '';
      items = phases.map((p,i)=>{
        const el = document.createElement('div'); el.className='phaseItem';
        el.innerHTML = `<div class="glow"></div><div>${i+1}. ${p.name}</div>`;
        el.addEventListener('click',()=>{ setPhase(i,true); renderTimeline(); });
        el.addEventListener('mouseenter', (ev)=> showTip(`${i+1}. ${p.name}`, p.desc, ev.clientX, ev.clientY));
        el.addEventListener('mousemove', (ev)=> moveTip(ev.clientX, ev.clientY));
        el.addEventListener('mouseleave', hideTip);
        tl.appendChild(el); return el; });
      renderTimeline();
    }
    function renderTimeline(){ items.forEach((el,i)=> el.classList.toggle('active', i===phaseIndex)); }

    // ============= ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆå…ˆã«åˆæœŸåŒ–ã—ã¦ãŠãï¼‰ =============
    const tip = document.getElementById('tip');
    const tipTitle = tip.querySelector('.title');
    const tipBody = tip.querySelector('.body');
    function showTip(title, body, x, y){
      tipTitle.textContent = title; tipBody.textContent = body;
      tip.style.display='block';
      const pad = 14; const rect={w: tip.offsetWidth, h: tip.offsetHeight};
      const nx = Math.min(window.innerWidth-rect.w-pad, x+16);
      const ny = Math.min(window.innerHeight-rect.h-pad, y+16);
      tip.style.left = nx+'px'; tip.style.top = ny+'px';
    }
    function moveTip(x,y){
      if(tip.style.display==='none') return; const pad=14; const rect={w: tip.offsetWidth, h: tip.offsetHeight};
      const nx = Math.min(window.innerWidth-rect.w-pad, x+16);
      const ny = Math.min(window.innerHeight-rect.h-pad, y+16);
      tip.style.left = nx+'px'; tip.style.top = ny+'px';
    }
    function hideTip(){ tip.style.display='none'; }

    // ============= ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ å‚è€ƒã‚³ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ï¼ˆå…ˆã«å®šç¾©ï¼‰ =============
    const phaseRefs = {
      init: [],
      post: [
        {label:'USS README', path:'user-signal-service/README.md'},
        {label:'UUA README', path:'unified_user_actions/README.md'}
      ],
      early: [
        {label:'USS README', path:'user-signal-service/README.md'},
        {label:'RealGraph README', path:'src/scala/com/twitter/interaction_graph/README.md'}
      ],
      cand: [
        {label:'Home Mixer README', path:'home-mixer/README.md'},
        {label:'CRâ€‘Mixer README', path:'cr-mixer/README.md'},
        {label:'UTEG README', path:'src/scala/com/twitter/recos/user_tweet_entity_graph/README.md'},
        {label:'TimelineRanker README', path:'timelineranker/README.md'},
        {label:'FRS README', path:'follow-recommendations-service/README.md'}
      ],
      feat: [
        {label:'Graph Feature Service', path:'graph-feature-service/README.md'},
        {label:'Representation Manager', path:'representation-manager/README.md'},
        {label:'Representation Scorer', path:'representation-scorer/README.md'}
      ],
      rank: [
        {label:'ScoredTweetsModelScoringPipelineConfig.scala', path:'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/scored_tweets/scoring_pipeline/ScoredTweetsModelScoringPipelineConfig.scala'}
      ],
      mix: [
        {label:'ForYouScoredTweetsMixerPipelineConfig.scala', path:'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/for_you/ForYouScoredTweetsMixerPipelineConfig.scala'},
        {label:'Visibilitylib README', path:'visibilitylib/README.md'}
      ],
      dist: [
        {label:'Pushservice README', path:'pushservice/README.md'}
      ],
      spread: [
        {label:'SimClustersâ€‘ANN README', path:'simclusters-ann/README.md'},
        {label:'Topic Social Proof README', path:'topic-social-proof/README.md'}
      ],
      buzz: [
        {label:'Home Mixer README', path:'home-mixer/README.md'}
      ]
    };
    function renderPhaseRefs(){
      const list = document.getElementById('phaseRefList'); if(!list) return;
      const p = phases[phaseIndex]; const arr = phaseRefs[p.key]||[];
      list.innerHTML='';
      arr.forEach(it=>{
        const li=document.createElement('li');
        const local = document.createElement('a'); local.href = '../'+it.path; local.target='_blank'; local.rel='noopener'; local.textContent=it.label+'ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰';
        const gh = document.createElement('a'); gh.href = 'https://github.com/kazuph/the-algorithm/tree/main/'+it.path; gh.target='_blank'; gh.rel='noopener'; gh.textContent='GitHub';
        li.appendChild(local); li.appendChild(document.createTextNode(' / ')); li.appendChild(gh); list.appendChild(li);
      });
    }

    function setPhase(idx, manual=false){
      phaseIndex = clamp(idx,0,phases.length-1);
      phaseTimer = 0; renderTimeline();
      const p = phases[phaseIndex];
      badge.textContent = `${phaseIndex+1}. ${p.name}`; badge.setAttribute('data-text', badge.textContent);
      phaseDesc.textContent = p.desc;
      flash.classList.add('on'); badge.classList.add('on');
      setTimeout(()=>{flash.classList.remove('on');badge.classList.remove('on');}, 650);
      // ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»: å…‰ã®æµå…¥ (å‘¨è¾ºã‹ã‚‰ä¸­å¿ƒã¸ã®ãƒ•ãƒ¬ã‚¢)
      // ãƒ•ã‚§ãƒ¼ã‚º0ï¼ˆæº–å‚™ï¼‰ã§ã¯ãƒãƒ¼ã‚¹ãƒˆã‚’ç™ºç”Ÿã•ã›ãªã„
      if(phaseIndex>0){ for(let i=0;i<60;i++) spawnRadialBurst(); }
      // æº–å‚™æ®µéšã«æˆ»ã£ãŸã‚‰æ—¢å­˜ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ã‚¯ãƒªã‚¢
      if(phaseIndex===0){ particles.length = 0; }
      if(manual) lastTime = performance.now();
      renderPhaseRefs();
    }

    // ============= å…‰ã®æµå…¥ (ãƒ•ã‚§ãƒ¼ã‚ºåŠ¹æœ) =============
    const bursts=[];
    function spawnRadialBurst(){
      const r = Math.random()*Math.min(W,H)/2; const ang = Math.random()*Math.PI*2; const cx=W/2, cy=H/2;
      const x = cx + Math.cos(ang)*r; const y = cy + Math.sin(ang)*r;
      bursts.push({x,y, t:0, life: rand(0.6,1.2), hue: rand(170,210)});
    }

    // ============= ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ— =============
    let lastTime = performance.now();
    function loop(now){
      const dt = Math.min(60, now-lastTime); lastTime = now; // ms
      if(playing){
        phaseTimer += dt;
        if(phaseTimer>phaseDur && phaseIndex<phases.length-1){ setPhase(phaseIndex+1); }
      }
      draw(dt/1000);
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    // ============= æç”» =============
    let ambient = 0.35; // èƒŒæ™¯å…‰
    function draw(dt){
      // èƒŒæ™¯
      ctx.clearRect(0,0,W,H);
      // ã»ã‚“ã®ã‚Šãƒã‚¤ã‚º
      ctx.globalAlpha = 0.08; ctx.globalCompositeOperation='screen';
      for(let i=0;i<3;i++){
        const g = ctx.createLinearGradient(0,0,W,H);
        g.addColorStop(0,`hsla(${200+i*30},100%,50%,0.03)`);
        g.addColorStop(1,'transparent'); ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
      }
      ctx.globalAlpha = 1; ctx.globalCompositeOperation='source-over';

      // ã‚¨ãƒƒã‚¸å¼·åº¦ã‚’ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã«èª¿æ•´
      const p = phases[phaseIndex];
      const edgeBoostAll = p.boost?.all || 0;
      const list = p.boost?.edges || [];
      for(const e of edges){ e.intensity = e.base*(1+edgeBoostAll); }
      for(const key of list){ // 'a->b' å½¢å¼
        const [a,b] = key.split('->');
        const e = edges.find(x=>x.a.id===a && x.b.id===b); if(e) e.intensity = e.base*(p.boost.amount||1.5);
      }

      // ãƒ¢ãƒ¼ãƒ‰å¼·èª¿ï¼ˆå¯¾è±¡ã‚¨ãƒƒã‚¸ã¯å°‘ã—å¢—å¹…ã€éå¯¾è±¡ã¯å¼±ã‚ï¼‰
      const mb = modeBoosts[currentMode];
      if(mb){
        for(const e of edges){
          const key = `${e.a.id}->${e.b.id}`;
          if(mb.edges.has(key)) e.intensity *= mb.k; else e.intensity *= 0.9;
        }
      }

      // ç¾åœ¨ãƒ•ã‚§ãƒ¼ã‚ºã¾ã§ã«è¨±å¯ã•ã‚ŒãŸã‚¨ãƒƒã‚¸é›†åˆã‚’ä½œæˆ
      let allowAll = false;
      const allowedKeys = new Set();
      if(phaseIndex===0){
        // æº–å‚™ãƒ•ã‚§ãƒ¼ã‚ºã¯ç™ºå…‰ã®ã¿ï¼ˆå¾Œç¶šã§ç²’å­ç™ºç”Ÿã¯æŠ‘åˆ¶ï¼‰
      } else {
        for(let i=1;i<=phaseIndex;i++){
          const bp = phases[i]?.boost;
          if(!bp) continue;
          if(bp.all){ allowAll = true; break; }
          (bp.edges||[]).forEach(k=>allowedKeys.add(k));
        }
      }
      const activeEdges = allowAll ? edges : edges.filter(e=> allowedKeys.has(`${e.a.id}->${e.b.id}`));
      // éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒƒã‚¸ã®å¯è¦–ã‚°ãƒ­ãƒ¼ã‚’å¼±ã‚ã‚‹
      if(!allowAll){
        for(const e of edges){
          const k = `${e.a.id}->${e.b.id}`;
          if(!allowedKeys.has(k)) e.intensity *= (phaseIndex===0 ? 0 : 0.15);
        }
      }

      // ã‚¨ãƒƒã‚¸ã®ã‚°ãƒ­ãƒ¼ãƒ©ã‚¤ãƒ³
      for(const e of edges){
        const grad = ctx.createLinearGradient(e.a.x,e.a.y,e.b.x,e.b.y);
        const hue = 200 + (e.intensity*120);
        grad.addColorStop(0,`hsla(${hue},100%,60%,${0.15+0.25*e.intensity})`);
        grad.addColorStop(1,`hsla(${hue+40},100%,60%,0)`);
        ctx.strokeStyle = grad; ctx.lineWidth = 2 + 2*e.intensity; ctx.globalCompositeOperation='screen';
        ctx.beginPath(); ctx.moveTo(e.a.x,e.a.y); ctx.quadraticCurveTo(e.cx,e.cy,e.b.x,e.b.y); ctx.stroke();
      }

      // ãƒãƒ¼ãƒ‰
      const css = getComputedStyle(document.documentElement);
      for(const n of nodes){
        const r = 12; const neon = css.getPropertyValue(n.color).trim() || '#0ff';
        // å¤–å‘¨ã‚°ãƒ­ãƒ¼
        ctx.globalAlpha = 0.28 + 0.32*ambient; ctx.fillStyle = neon; ctx.beginPath(); ctx.arc(n.x,n.y, r*3.2, 0, Math.PI*2); ctx.fill();
        // æœ¬ä½“
        ctx.globalAlpha = 1; ctx.fillStyle = '#ffffff'; ctx.strokeStyle = '#95b8ff'; ctx.lineWidth=1.4; ctx.beginPath(); ctx.arc(n.x,n.y,r,0,Math.PI*2); ctx.fill(); ctx.stroke();
        // ãƒ©ãƒ™ãƒ«
        ctx.font = `${12*DPR}px 'Noto Sans JP', 'Inter', sans-serif`; ctx.textAlign='center'; ctx.textBaseline='top';
        ctx.fillStyle = 'rgba(31,39,64,.9)'; multiLine(n.label, n.x, n.y + r + 6*DPR);
      }

      // ãƒãƒ¼ãƒ‰å¼·èª¿ï¼ˆç”¨èªå¸³ã‹ã‚‰ã®ã‚¸ãƒ£ãƒ³ãƒ—ï¼‰
      if(hi.t>0 && hi.id && nodeMap.get(hi.id)){
        const n = nodeMap.get(hi.id); hi.t -= dt; const k = Math.max(0,hi.t);
        ctx.globalCompositeOperation='lighter';
        ctx.strokeStyle = `rgba(43,125,233,${0.6*k})`; ctx.lineWidth = 2 + 10*k; ctx.beginPath(); ctx.arc(n.x, n.y, 24 + 20*k, 0, Math.PI*2); ctx.stroke();
        ctx.globalCompositeOperation='source-over';
      }

      // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç™ºç”Ÿï¼ˆãƒ•ã‚§ãƒ¼ã‚º0ã§ã¯ç™ºç”Ÿã•ã›ãªã„ã€‚è¨±å¯ã‚¨ãƒƒã‚¸ã®ã¿ã«é™å®šï¼‰
      const baseRate = 80; // /sec å…¨ä½“
      const canEmit = phaseIndex>0 && activeEdges.length>0;
      const rate = (canEmit? baseRate : 0) * (0.6 + phaseIndex*0.25) * (0.6 + reachMul*0.4);
      const emitCount = rate*dt;
      if(canEmit){
        for(let i=0;i<emitCount;i++){
          const e = activeEdges[Math.floor(Math.random()*activeEdges.length)];
          if(Math.random() < e.intensity) spawnOnEdge(e);
        }
      }
      // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ›´æ–°/æç”»
      ctx.globalCompositeOperation = 'lighter';
      for(let i=particles.length-1;i>=0;i--){
        const k = particles[i]; k.t += k.v*dt; k.life -= dt*0.4;
        if(k.t>1 || k.life<=0){ particles.splice(i,1); continue; }
        const pt = edgePoint(k.e, k.t);
        const s = 1.5 + 2.5*k.e.intensity;
        ctx.fillStyle = `hsla(${k.hue},100%,60%,${0.35+0.45*k.life})`;
        ctx.beginPath(); ctx.arc(pt.x, pt.y, s, 0, Math.PI*2); ctx.fill();
      }

      // ãƒãƒ¼ã‚¹ãƒˆ (å…‰ã®æµå…¥)
      for(let i=bursts.length-1;i>=0;i--){
        const b = bursts[i]; b.t += dt; const k = b.t/b.life; if(k>=1){bursts.splice(i,1);continue;}
        ctx.strokeStyle = `hsla(${b.hue},100%,60%,${0.7*(1-k)})`; ctx.lineWidth=1.2; ctx.beginPath();
        const cx=W/2, cy=H/2; ctx.moveTo(b.x,b.y); ctx.lineTo(lerp(b.x,cx,k*k), lerp(b.y,cy,k*k)); ctx.stroke();
      }

      ctx.globalCompositeOperation='source-over';

      // ãƒã‚ºãƒ¡ãƒ¼ã‚¿ãƒ¼æ›´æ–°: ç·Intensityã¨ãƒ•ã‚§ãƒ¼ã‚ºã§æ“¬ä¼¼ç®—å‡º
      const sumI = edges.reduce((s,e)=>s+e.intensity,0);
      const buzz = clamp((sumI/edges.length)*0.55 + phaseIndex*0.05 + reachMul*0.15 + (currentMode==='foryou'?0.05:0), 0, 1);
      document.getElementById('buzzBar').style.height = (8 + buzz*92).toFixed(1)+'%';
      document.getElementById('buzzPercent').textContent = Math.round((8 + buzz*92))+'%';
    }

    function multiLine(text, x, y){
      const lines = String(text).split(/\\n/);
      for(let i=0;i<lines.length;i++) ctx.fillText(lines[i], x, y + i*14*DPR);
    }

    // ============= ãƒœã‚¿ãƒ³åˆ¶å¾¡ =============
    const btnPlay = document.getElementById('btnPlay');
    const btnNext = document.getElementById('btnNext');
    const btnPrev = document.getElementById('btnPrev');
    const btnReset = document.getElementById('btnReset');
    const btnGlossary = document.getElementById('btnGlossary');
    const btnCodeNav = document.getElementById('btnCodeNav');
    const vocabSimpleBtn = document.getElementById('vocabSimple');
    const vocabExpertBtn = document.getElementById('vocabExpert');
    const modeForYou = document.getElementById('modeForYou');
    const modeFollowing = document.getElementById('modeFollowing');
    const modePush = document.getElementById('modePush');
    const btnSavePng = document.getElementById('btnSavePng');
    const btnLayoutReset = document.getElementById('btnLayoutReset');

    btnPlay.addEventListener('click',()=>{
      playing = !playing; btnPlay.textContent = playing ? 'â¸ ä¸€æ™‚åœæ­¢' : 'âµ å†ç”Ÿ';
      if(playing && phaseIndex===0) setPhase(1,true);
    });
    btnNext.addEventListener('click',()=>{ setPhase(phaseIndex+1,true); playing=false; btnPlay.textContent='âµ å†ç”Ÿ'; });
    btnPrev.addEventListener('click',()=>{ setPhase(phaseIndex-1,true); playing=false; btnPlay.textContent='âµ å†ç”Ÿ'; });
    btnReset.addEventListener('click',()=>{ setPhase(0,true); playing=false; btnPlay.textContent='âµ å†ç”Ÿ'; });
    btnGlossary.addEventListener('click',()=>{ openGlossary(); });
    btnCodeNav.addEventListener('click',()=>{ openCodeNav(); });
    // ç”¨èªãƒ¬ãƒ™ãƒ«åˆ‡æ›¿
    let vocabMode = 'simple';
    function setVocabMode(m){
      vocabMode = (m==='expert') ? 'expert' : 'simple';
      // ãƒœã‚¿ãƒ³ã®UIçŠ¶æ…‹
      vocabSimpleBtn.classList.toggle('on', vocabMode==='simple');
      vocabExpertBtn.classList.toggle('on', vocabMode==='expert');
      vocabSimpleBtn.setAttribute('aria-selected', vocabMode==='simple');
      vocabExpertBtn.setAttribute('aria-selected', vocabMode==='expert');
      // ãƒãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«æ›´æ–°
      const map = nodeLabels[vocabMode];
      nodes.forEach(n=>{ if(map[n.id]) n.label = map[n.id]; });
      layout();
      // ãƒãƒ¼ãƒ‰èª¬æ˜è¾æ›¸åˆ‡æ›¿
      nodeInfo = (vocabMode==='simple') ? nodeInfoSimple : nodeInfoExpert;
      // ãƒ•ã‚§ãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿åˆ‡æ›¿
      phases = (vocabMode==='simple') ? phasesSimple : phasesExpert;
      // å‡¡ä¾‹ã®æ–‡è¨€
      const lg = legendText[vocabMode];
      const ld = document.getElementById('legend-data'); if(ld) ld.innerHTML = `<span class="dot c1"></span> ${lg.data}`;
      const lc = document.getElementById('legend-cand'); if(lc) lc.innerHTML = `<span class="dot c4"></span> ${lg.cand}`;
      const lr = document.getElementById('legend-rank'); if(lr) lr.innerHTML = `<span class="dot c2"></span> ${lg.rank}`;
      const lm = document.getElementById('legend-mix'); if(lm) lm.innerHTML = `<span class="dot c3"></span> ${lg.mix}`;
      // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å†æ§‹ç¯‰ã¨ãƒ•ã‚§ãƒ¼ã‚ºå†è¡¨ç¤º
      const keep = clamp(phaseIndex,0,phases.length-1);
      buildTimeline();
      setPhase(keep, true);
      // ä¿å­˜
      try{ localStorage.setItem('vocabMode', vocabMode); }catch(_){ }
    }
    vocabSimpleBtn.addEventListener('click',()=> setVocabMode('simple'));
    vocabExpertBtn.addEventListener('click',()=> setVocabMode('expert'));
    btnSavePng.addEventListener('click',()=>{
      try { const url = canvas.toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download='buzz-flow.png'; a.click(); } catch(e){}
    });
    btnLayoutReset.addEventListener('click',()=>{ localStorage.removeItem('nodePositions'); location.reload(); });
    function setMode(m){
      currentMode = m;
      modeForYou.classList.toggle('on', m==='foryou');
      modeFollowing.classList.toggle('on', m==='following');
      modePush.classList.toggle('on', m==='push');
      modeForYou.setAttribute('aria-selected', m==='foryou');
      modeFollowing.setAttribute('aria-selected', m==='following');
      modePush.setAttribute('aria-selected', m==='push');
      flash.classList.add('on'); setTimeout(()=>flash.classList.remove('on'), 500);
    }
    modeForYou.addEventListener('click',()=>setMode('foryou'));
    modeFollowing.addEventListener('click',()=>setMode('following'));
    modePush.addEventListener('click',()=>setMode('push'));

    // ============= å€ç‡ãƒ¢ãƒ‡ãƒ« =============
    const factors = {
      earlyVelocity: 1.2,  // USSåˆæœŸåå¿œé€Ÿåº¦
      socialProof: 1.1,    // ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼çµŒç”±ã®ç¤¾ä¼šçš„è¨¼æ‹ 
      authorCred: 1.0,     // ä½œè€…ä¿¡é ¼/é–¢ä¿‚
      topicFit: 1.0,       // ãƒˆãƒ”ãƒƒã‚¯åˆè‡´
      dwell: 1.0,          // è¦–è´ç¶­æŒ/æ»åœ¨
      novelty: 1.0,        // æ–°è¦æ€§
      fatigue: 1.0,        // ç–²åŠ´(<=1)
      dedupe: 1.0,         // é‡è¤‡æŠ‘åˆ¶(<=1)
      authorDivers: 1.0,   // ä½œè€…å¤šæ§˜æ€§(<=1)
      safety: 1.0,         // å¯è¦–æ€§/å®‰å…¨(<=1)
      negFeedback: 1.0,    // ä½è©•ä¾¡è“„ç©(<=1)
      outlink: 1.0         // å¤–éƒ¨ãƒªãƒ³ã‚¯(ä»®èª¬)(<=1)
    };
    let reachMul = 1.0;
    const multUI = document.getElementById('multUI');
    function updateReach(){
      reachMul = 1.0;
      for(const k in factors){ reachMul *= Number(factors[k]); }
      document.getElementById('reachNow').textContent = reachMul.toFixed(2)+'x';
    }
    // bind inputs
    multUI.querySelectorAll('input[type=range], select').forEach(el=>{
      const key = el.getAttribute('data-factor');
      const updateVal = ()=>{
        factors[key] = Number(el.value);
        const span = document.getElementById('val-'+key); if(span) span.textContent = factors[key].toFixed(2)+'x';
        updateReach();
      };
      el.addEventListener('input', updateVal);
    });
    // presets
    multUI.querySelectorAll('button[data-preset]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const p = btn.getAttribute('data-preset');
        function set(id,val){ const el = multUI.querySelector(`[data-factor="${id}"]`); if(el){ el.value = val; el.dispatchEvent(new Event('input')); } }
        if(p==='reset'){
          set('earlyVelocity',1.2); set('socialProof',1.1); set('authorCred',1.0); set('topicFit',1.0); set('dwell',1.0); set('novelty',1.0);
          set('fatigue',1.0); set('dedupe',1.0); set('authorDivers',1.0); multUI.querySelector('[data-factor="safety"]').value='1'; set('negFeedback',1.0); set('outlink',1.0);
        }
        if(p==='text'){
          set('earlyVelocity',1.3); set('socialProof',1.2); set('authorCred',1.0); set('topicFit',1.2); set('dwell',1.0); set('novelty',1.1);
          set('fatigue',1.0); set('dedupe',1.0); set('authorDivers',1.0); multUI.querySelector('[data-factor="safety"]').value='1'; set('negFeedback',1.0); set('outlink',1.0);
        }
        if(p==='video'){
          set('earlyVelocity',1.5); set('socialProof',1.3); set('authorCred',1.1); set('topicFit',1.2); set('dwell',1.5); set('novelty',1.1);
          set('fatigue',0.95); set('dedupe',1.0); set('authorDivers',1.0); multUI.querySelector('[data-factor="safety"]').value='1'; set('negFeedback',1.0); set('outlink',1.0);
        }
        if(p==='link'){
          set('earlyVelocity',1.2); set('socialProof',1.1); set('authorCred',1.0); set('topicFit',1.1); set('dwell',1.0); set('novelty',1.0);
          set('fatigue',0.95); set('dedupe',1.0); set('authorDivers',1.0); multUI.querySelector('[data-factor="safety"]').value='1'; set('negFeedback',1.0); set('outlink',0.9);
        }
        if(p==='thread'){
          set('earlyVelocity',1.4); set('socialProof',1.25); set('authorCred',1.05); set('topicFit',1.25); set('dwell',1.15); set('novelty',1.05);
          set('fatigue',0.95); set('dedupe',0.9); set('authorDivers',0.95); multUI.querySelector('[data-factor="safety"]').value='1'; set('negFeedback',1.0); set('outlink',1.0);
        }
        updateReach();
      });
    });
    updateReach();

    // ç”¨èªãƒ¢ãƒ¼ãƒ‰åˆæœŸåŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ã‚„ã•ã—ã„ï¼‰
    try{ setVocabMode(localStorage.getItem('vocabMode')||'simple'); }catch(_){ setVocabMode('simple'); }

    // åˆæœŸãƒ•ã‚§ãƒ¼ã‚º
    setPhase(0,true);

    // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³: ãƒ›ãƒãƒ¼ã§èª¬æ˜ï¼ˆbuildTimelineå†…ã§è¨­å®šï¼‰

    // èª­ã¿ã‚‚ã®: summaryã‚¯ãƒªãƒƒã‚¯ã§è©²å½“ãƒ•ã‚§ãƒ¼ã‚ºã¸
    reader?.querySelectorAll('summary[data-phase]')?.forEach(sm=>{
      sm.addEventListener('click', (e)=>{
        const idx = Number(sm.getAttribute('data-phase'))||0; setPhase(idx,true);
      });
    });

    // ============= ãƒãƒ¼ãƒ‰èª¬æ˜ã¨ãƒ‰ãƒ©ãƒƒã‚° =============

    let hoverNode=null; let dragNode=null; let dragging=false;
    canvas.addEventListener('pointermove', (ev)=>{
      const mx = ev.offsetX*DPR, my = ev.offsetY*DPR;
      // ãƒãƒ¼ãƒ‰å½“ãŸã‚Šåˆ¤å®š
      let found=null; const r=12; const tol=r*1.4;
      for(const n of nodes){
        const dx = mx-n.x, dy = my-n.y; if(dx*dx+dy*dy <= tol*tol){ found=n; break; }
      }
      hoverNode = found;
      if(dragging && dragNode){
        dragNode.x = clamp(mx, 10*DPR, W-10*DPR); dragNode.y = clamp(my, 10*DPR, H-10*DPR);
        dragNode.pos[0] = dragNode.x/W; dragNode.pos[1] = dragNode.y/H; layout(); // å†è¨ˆç®—
        moveTip(ev.clientX, ev.clientY);
      } else {
        if(found){
          canvas.style.cursor = 'grab';
          const title = nodeMap.get(found.id)?.label?.split('\n')[0] || found.id;
          showTip(title, nodeInfo[found.id]||'', ev.clientX, ev.clientY);
        } else {
          canvas.style.cursor = 'default'; hideTip();
        }
      }
    });
    canvas.addEventListener('pointerdown', (ev)=>{
      if(hoverNode){ dragNode = hoverNode; dragging=true; canvas.setPointerCapture(ev.pointerId); canvas.style.cursor='grabbing'; ev.preventDefault(); }
    });
    window.addEventListener('pointerup', (ev)=>{
      if(dragging){ dragging=false; canvas.releasePointerCapture?.(ev.pointerId); canvas.style.cursor='grab'; saveNodePositions(); }
    });

    function saveNodePositions(){
      const map={}; nodes.forEach(n=> map[n.id]=n.pos); localStorage.setItem('nodePositions', JSON.stringify(map));
    }
    function loadNodePositions(){
      try{ const raw=localStorage.getItem('nodePositions'); if(!raw) return; const map=JSON.parse(raw);
        nodes.forEach(n=>{ if(map[n.id]){ n.pos = map[n.id]; } }); layout();
      }catch(e){}
    }
    loadNodePositions();


    // ============= ã‚·ã‚°ãƒŠãƒ«æ¢ç´¢ï¼ˆRETREIVAL_SIGNALS.mdè¦ç´„ï¼‰ =============
    const signalsData = [
      {name:'Author Follow', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€‚', used:['USS','FRS','SimClusters','TwHIN'], nodes:['uss','frs','users']},
      {name:'Author Unfollow', desc:'æœ€è¿‘ã®ã‚¢ãƒ³ãƒ•ã‚©ãƒ­ãƒ¼ã€‚', used:['USS'], nodes:['uss']},
      {name:'Author Mute', desc:'ãƒŸãƒ¥ãƒ¼ãƒˆã€‚', used:['USS','FRS'], nodes:['uss','frs']},
      {name:'Author Block', desc:'ãƒ–ãƒ­ãƒƒã‚¯ã€‚', used:['USS','FRS'], nodes:['uss','frs']},
      {name:'Tweet Favorite', desc:'ã„ã„ã­ã€‚å¤šãã®ç®‡æ‰€ã§ç‰¹å¾´/ãƒ©ãƒ™ãƒ«ã«ä½¿ç”¨ã€‚', used:['USS','SimClusters','TwHIN','UTEG','FRS','Light'], nodes:['uss','uteg','lightr','users']},
      {name:'Retweet', desc:'ãƒªãƒ„ã‚¤ãƒ¼ãƒˆã€‚', used:['USS','UTEG','FRS','Light'], nodes:['uss','uteg','lightr']},
      {name:'Quote Tweet', desc:'å¼•ç”¨ã€‚', used:['USS','UTEG','FRS','Light'], nodes:['uss','uteg','lightr']},
      {name:'Reply', desc:'è¿”ä¿¡ã€‚', used:['USS','UTEG','Light'], nodes:['uss','uteg','lightr']},
      {name:'Tweet Click', desc:'è©³ç´°ã‚¯ãƒªãƒƒã‚¯ã€‚', used:['USS','FRS','Light(Labels)'], nodes:['uss','lightr']},
      {name:'Video Watch', desc:'ä¸€å®šç§’/å‰²åˆã®è¦–è´ã€‚', used:['USS','SimClusters','Light(Labels)'], nodes:['uss','lightr','users']},
      {name:'Notification Open', desc:'é€šçŸ¥é–‹å°ã€‚', used:['USS','SimClusters','TwHIN','FRS'], nodes:['uss','distribution','users']},
      {name:'Ntab Click', desc:'é€šçŸ¥ã‚¿ãƒ–ã‚¯ãƒªãƒƒã‚¯ã€‚', used:['USS','SimClusters','TwHIN'], nodes:['uss','users']},
      {name:'AddressBook', desc:'ã‚¢ãƒ‰ãƒ¬ã‚¹å¸³ã®è‘—è€…IDã€‚', used:['FRS'], nodes:['frs']}
    ];
    function renderSignals(){
      const body = document.getElementById('sigBody'); const q = (document.getElementById('sigSearch')?.value||'').toLowerCase();
      if(!body) return; body.innerHTML='';
      signalsData.filter(s=>!q || (s.name+' '+s.desc).toLowerCase().includes(q)).forEach(sig=>{
        const d=document.createElement('div'); d.className='sigItem';
        d.innerHTML = `<div class="name">${sig.name}</div><div class="desc">${sig.desc}</div><div class="used">Used: ${sig.used.join(', ')}</div>`;
        d.addEventListener('click',()=>{ if(sig.nodes?.length) highlightNode(sig.nodes[0]); pulseEdgesForNodes(sig.nodes||[]); });
        body.appendChild(d);
      });
    }
    function pulseEdgesForNodes(nodeIds){
      const set = new Set(nodeIds);
      edges.forEach(e=>{ if(set.has(e.a.id)||set.has(e.b.id)){ for(let i=0;i<30;i++) spawnOnEdge(e); } });
    }
    document.getElementById('sigSearch')?.addEventListener('input', renderSignals);
    renderSignals();

    // ============= ã‚¹ã‚³ã‚¢å¯„ä¸ï¼ˆç©å…·ï¼‰ =============
    const weights = { w_sp:1.2, w_sim:1.1, w_auth:1.0, w_quality:1.0, w_dwell:1.0, w_topic:1.0, w_fresh:1.0, p_safety:0.0, p_fatigue:0.0, p_dedupe:0.0 };
    function updateAttr(){
      const posParts = [
        ['ç¤¾ä¼šçš„è¨¼æ‹ ', weights.w_sp * factors.socialProof],
        ['é¡ä¼¼åº¦', weights.w_sim * 1.0],
        ['è‘—è€…è¦ªå’Œ', weights.w_auth * 1.0],
        ['å†…å®¹å“è³ª', weights.w_quality * 1.0],
        ['æ»åœ¨/è¦–è´', weights.w_dwell * factors.dwell],
        ['ãƒˆãƒ”ãƒƒã‚¯', weights.w_topic * factors.topicFit],
        ['é®®åº¦', weights.w_fresh * factors.novelty]
      ];
      const negParts = [
        ['å¯è¦–æ€§', weights.p_safety],
        ['ç–²åŠ´', weights.p_fatigue],
        ['é‡è¤‡', weights.p_dedupe]
      ];
      const posSum = posParts.reduce((s,[_n,v])=>s+v,0);
      const negSum = negParts.reduce((s,[_n,v])=>s+v,0);
      const score = Math.max(0, Math.min(1, (0.5*posSum)/(1+posSum) - negSum*0.2 + 0.5));
      const posPct = Math.max(0, Math.min(100, 100*(posSum/(posSum+1)) ));
      const negPct = Math.max(0, Math.min(100, 100*(negSum/3) ));
      document.getElementById('attrScore').textContent = score.toFixed(2);
      document.getElementById('attrPos').style.width = Math.max(8,posPct).toFixed(1)+'%';
      document.getElementById('attrNeg').style.width = Math.min(92,negPct).toFixed(1)+'%';
      // top drivers
      const top = posParts.slice().sort((a,b)=>b[1]-a[1]).slice(0,3).map(([n,_])=>n);
      document.getElementById('attrTop').textContent = 'Top drivers: '+top.join(', ');
    }
    document.querySelectorAll('[data-w]')?.forEach(el=>{
      const key = el.getAttribute('data-w'); const span = document.getElementById('wval-'+key);
      const update=()=>{ weights[key]=Number(el.value); if(span) span.textContent = weights[key].toFixed(2); updateAttr(); };
      el.addEventListener('input', update);
    });
    document.querySelectorAll('button[data-persona]')?.forEach(btn=>{
      btn.addEventListener('click',()=>{
        const p = btn.getAttribute('data-persona');
        function setW(k,v){ const el=document.querySelector(`[data-w="${k}"]`); if(el){ el.value=v; el.dispatchEvent(new Event('input')); } }
        if(p==='reset'){ ['w_sp','w_sim','w_auth','w_quality','w_dwell','w_topic','w_fresh'].forEach((k,i)=>setW(k,1.0)); setW('w_sp',1.2); setW('w_sim',1.1); ['p_safety','p_fatigue','p_dedupe'].forEach(k=>setW(k,0)); return; }
        if(p==='sports'){ setW('w_topic',1.6); setW('w_sp',1.4); setW('w_sim',1.2); }
        if(p==='tech'){ setW('w_topic',1.6); setW('w_sim',1.4); setW('w_auth',1.1); }
        if(p==='music'){ setW('w_topic',1.6); setW('w_dwell',1.3); setW('w_sp',1.2); }
      });
    });
    updateAttr();

    // ============= ç”¨èªå¸³ï¼ˆGlossaryï¼‰ =============
    const glossaryData = [
      {id:'tweet', term:'æŠ•ç¨¿ï¼ˆãƒã‚¹ãƒˆï¼‰', desc:'Xä¸Šã®æ–°è¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€‚ãƒ†ã‚­ã‚¹ãƒˆ/ç”»åƒ/å‹•ç”»/ãƒªãƒ³ã‚¯ãªã©å½¢å¼ã‚’å•ã‚ãšèµ·ç‚¹ã€‚', cat:'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„', node:'tweet'},
      {id:'uss', term:'USSï¼ˆUser Signal Serviceï¼‰', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ä¿¡å·ï¼ˆã„ã„ã­/RT/è¿”ä¿¡/ã‚¯ãƒªãƒƒã‚¯/è¦–è´/ãƒ—ãƒ­ãƒ•è¨ªå•ç­‰ï¼‰ã‚’é›†ç´„ãƒ»æ­£è¦åŒ–ã™ã‚‹ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã€‚å€™è£œç”Ÿæˆã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç‰¹å¾´ã«åˆ©ç”¨ã€‚', cat:'ãƒ‡ãƒ¼ã‚¿/ä¿¡å·', node:'uss'},
      {id:'uua', term:'UUAï¼ˆUnified User Actionsï¼‰', desc:'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã€‚USSã®å…ƒãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦åˆ©ç”¨ã€‚', cat:'ãƒ‡ãƒ¼ã‚¿/ä¿¡å·'},
      {id:'earlybird', term:'Earlybirdï¼ˆæ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰', desc:'ä¸»ã«Inâ€‘Networkã®æŠ•ç¨¿ã‚’é«˜é€Ÿæ¤œç´¢ã—ã¦å€™è£œåŒ–ã€‚Light Rankerã«ã‚ˆã‚‹è»½ã„é †ä½ä»˜ã‘ã‚‚ã€‚', cat:'å€™è£œç”Ÿæˆ', node:'earlybird'},
      {id:'uteg', term:'UTEGï¼ˆUser Tweet Entity Graphï¼‰', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼Ã—æŠ•ç¨¿ã®ç›¸äº’ä½œç”¨ã‚°ãƒ©ãƒ•ï¼ˆGraphJetåŸºç›¤ï¼‰ã‹ã‚‰è¾¿ã£ã¦å€™è£œã‚’ç”Ÿæˆã€‚', cat:'å€™è£œç”Ÿæˆ', node:'uteg'},
      {id:'utg', term:'UTGï¼ˆUser Tweet Graphï¼‰', desc:'åŒæ–¹å‘ã®ã‚¨ãƒƒã‚¸ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼Ã—æŠ•ç¨¿ã®ã‚°ãƒ©ãƒ•ã€‚UTEGã‚ˆã‚ŠæŸ”è»Ÿãªå¤šæ®µãƒˆãƒ©ãƒãƒ¼ã‚¹ãŒå¯èƒ½ã ãŒãƒ¡ãƒ¢ãƒªä½¿ç”¨ãŒå¤§ãã„ã€‚', cat:'å€™è£œç”Ÿæˆ'},
      {id:'crmixer', term:'CRâ€‘Mixer', desc:'è¤‡æ•°ã®å€™è£œæºã‚’æ··åˆã—ã€å…±é€šã®è»½ãƒ©ãƒ³ã‚¯/ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨ã™ã‚‹çµ±åˆå±¤ã€‚', cat:'å€™è£œç”Ÿæˆ', node:'crmixer'},
      {id:'frs', term:'FRSï¼ˆFollow Recommendations Serviceï¼‰', desc:'ãƒ•ã‚©ãƒ­ãƒ¼æ¨è–¦ã¨ã€ãã®æ¨è–¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç”±æ¥ã®æŠ•ç¨¿å€™è£œã‚’ä¾›çµ¦ã€‚', cat:'å€™è£œç”Ÿæˆ', node:'frs'},
      {id:'feature', term:'ç‰¹å¾´é‡æ°´å’Œï¼ˆFeature Hydrationï¼‰', desc:'ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«å¿…è¦ãªå¤šæ•°ã®ç‰¹å¾´ï¼ˆ~6000ï¼‰ã‚’å„ã‚¹ãƒˆã‚¢/ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å–å¾—ã—ã¦æ•´ãˆã‚‹å‡¦ç†ã€‚', cat:'ç‰¹å¾´é‡', node:'feat'},
      {id:'lightr', term:'Light Ranker', desc:'å‰æ®µã®è»½é‡ãƒ¢ãƒ‡ãƒ«ã€‚å·¨å¤§ãªå€™è£œé›†åˆã‹ã‚‰é‡ãƒ©ãƒ³ã‚¯ã«æ¸¡ã™æ¯é›†å›£ã‚’åœ§ç¸®ã€‚', cat:'ãƒ©ãƒ³ã‚­ãƒ³ã‚°', node:'lightr'},
      {id:'heavyr', term:'Heavy Ranker', desc:'ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆç­‰ã®æœ¬æ ¼çš„ãƒ¢ãƒ‡ãƒ«ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã—é †ä½ä»˜ã‘ã‚’æ±ºå®šã€‚', cat:'ãƒ©ãƒ³ã‚­ãƒ³ã‚°', node:'heavyr'},
      {id:'mixer', term:'Home Mixer', desc:'Product Mixerä¸Šã§ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®æœ€çµ‚æ§‹ç¯‰ã‚’è¡Œã†ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã€‚ä¼šè©±ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«/åºƒå‘Š/Who to followç­‰ã®æ··åœ¨ã‚‚æ‰±ã†ã€‚', cat:'ãƒŸã‚­ã‚·ãƒ³ã‚°', node:'mixer'},
      {id:'visibility', term:'Visibilityï¼ˆå¯è¦–æ€§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰', desc:'æ³•ä»¤/å“è³ª/ä¿¡é ¼/åç›Šä¿è­·ã®è¦³ç‚¹ã‹ã‚‰ã€éè¡¨ç¤ºãƒ»ãƒ©ãƒ™ãƒ«ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ãƒ†ã‚£ã‚·ãƒ£ãƒ«ãƒ»ãƒ€ã‚¦ãƒ³ãƒ©ãƒ³ã‚¯ç­‰ã®æ‰±ã„ã‚’æ±ºã‚ã‚‹ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ³ã‚¸ãƒ³ã€‚', cat:'å®‰å…¨/ãƒãƒªã‚·ãƒ¼', node:'filters'},
      {id:'distribution', term:'é…ä¿¡ï¼ˆFor You/é€šçŸ¥/Exploreï¼‰', desc:'æˆæœç‰©ã‚’å„é¢ã¸é…ä¿¡ã€‚é–²è¦§ãŒäºŒæ¬¡åå¿œã‚’ç”Ÿã¿ã€å†å¾ªç’°ã¸ã€‚', cat:'é…ä¿¡', node:'distribution'},
      {id:'users', term:'RealGraph / SimClusters', desc:'RealGraph: ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ç›¸äº’ä½œç”¨ã®ç¢ºç‡ãƒ¢ãƒ‡ãƒ«ã€‚SimClusters: ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡ºã¨ç–ãªåŸ‹ã‚è¾¼ã¿ã€‚', cat:'ãƒ¢ãƒ‡ãƒ«/ã‚°ãƒ©ãƒ•', node:'users'},
      {id:'simclustersann', term:'SimClustersâ€‘ANN', desc:'SimClustersåŸ‹ã‚è¾¼ã¿ã®è¿‘ä¼¼ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼ã§ãƒ„ã‚¤ãƒ¼ãƒˆå€™è£œã‚’è¿”ã™ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆApproximate Cosine Similarityï¼‰ã€‚', cat:'å€™è£œç”Ÿæˆ'},
      {id:'repManager', term:'Representation Manager', desc:'SimClustersã‚„TwHINãªã©ã®åŸ‹ã‚è¾¼ã¿ã‚’å–å¾—ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã€‚', cat:'ç‰¹å¾´é‡'},
      {id:'graphFeature', term:'Graph Feature Service', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“/ãƒ¦ãƒ¼ã‚¶ãƒ¼Ã—æŠ•ç¨¿ã®ã‚°ãƒ©ãƒ•ç‰¹å¾´ï¼ˆä¾‹: ã‚ã‚‹Aã®ãƒ•ã‚©ãƒ­ãƒ¼ãŒBã®æŠ•ç¨¿ã‚’ã©ã‚Œã ã‘ã€Œã„ã„ã­ã€ã—ãŸã‹ç­‰ï¼‰ã‚’æä¾›ã€‚', cat:'ç‰¹å¾´é‡'},
      {id:'repScorer', term:'Representation Scorer', desc:'åŸ‹ã‚è¾¼ã¿ã®é¡ä¼¼åº¦ã«åŸºã¥ãã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ã€‚', cat:'ç‰¹å¾´é‡'},
      {id:'topicSP', term:'Topic Social Proof', desc:'æŠ•ç¨¿ã«é–¢é€£ã™ã‚‹ãƒˆãƒ”ãƒƒã‚¯ã‚’æ¨å®šã—ã€ç¤¾ä¼šçš„æ–‡è„ˆã‚’ä»˜ä¸ã€‚', cat:'ç‰¹å¾´é‡'},
      {id:'twhin', term:'TwHIN', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼/æŠ•ç¨¿ã®å¯†ãªçŸ¥è­˜ã‚°ãƒ©ãƒ•åŸ‹ã‚è¾¼ã¿ã€‚', cat:'ãƒ¢ãƒ‡ãƒ«/åŸ‹ã‚è¾¼ã¿'},
      {id:'tweepcred', term:'Tweepcred', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¿¡ç”¨åº¦ã‚’PageRankæ§˜æ‰‹æ³•ã§æ¨å®šã™ã‚‹æŒ‡æ¨™ã€‚', cat:'ãƒ¢ãƒ‡ãƒ«/æŒ‡æ¨™'},
      {id:'timelineranker', term:'TimelineRanker', desc:'æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹/UTEGã‹ã‚‰å€™è£œã‚’å–å¾—ã—ã€è»½ã„ã‚¹ã‚³ã‚¢ã§æ•´å½¢ã™ã‚‹ãƒ¬ã‚¬ã‚·ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆé‡ãƒ©ãƒ³ã‚¯è‡ªä½“ã¯è¡Œã‚ãªã„ï¼‰ã€‚', cat:'å€™è£œç”Ÿæˆ'},
      {id:'tweetypie', term:'Tweetypie', desc:'æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿æ›¸ãã‚’æ‹…ã†ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹ã€‚è¡¨ç¤ºæ™‚ã®æ°´å’Œã«ã‚‚åˆ©ç”¨ã€‚', cat:'ãƒ‡ãƒ¼ã‚¿/åŸºç›¤'},
      {id:'manhattan', term:'Manhattan', desc:'ãƒ¦ãƒ¼ã‚¶ãƒ¼/ãƒ„ã‚¤ãƒ¼ãƒˆå±æ€§ç­‰ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€‚TimelineRankerã®ä¸€éƒ¨ç‰¹å¾´æ°´å’Œå…ƒã¨ã—ã¦åˆ©ç”¨ã€‚', cat:'ãƒ‡ãƒ¼ã‚¿/åŸºç›¤'},
      {id:'pushservice', term:'Pushservice', desc:'é€šçŸ¥å‘ã‘ã®æ¨è–¦ã‚µãƒ¼ãƒ“ã‚¹ã€‚é€šçŸ¥é–‹å°ã‚„åå¿œã®ç¢ºç‡ã‚’å¤šã‚¿ã‚¹ã‚¯å­¦ç¿’ã§äºˆæ¸¬ã€‚', cat:'é…ä¿¡'},
      {id:'productmixer', term:'Product Mixer', desc:'ãƒ•ã‚£ãƒ¼ãƒ‰æ§‹ç¯‰ã®ãŸã‚ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚Home Mixerç­‰ãŒã“ã‚Œä¸Šã«å®Ÿè£…ã•ã‚Œã‚‹ã€‚', cat:'ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯'}
    ];

    const gEl = document.getElementById('glossary');
    const gBody = document.getElementById('gBody');
    const gSearch = document.getElementById('gSearch');
    const gClose = document.getElementById('gClose');

    function openGlossary(){ gEl.style.display='block'; renderGlossary(); gSearch.focus(); }
    function closeGlossary(){ gEl.style.display='none'; }
    gClose?.addEventListener('click', closeGlossary);
    window.addEventListener('keydown', (e)=>{
      if(e.key==='Escape'&& gEl.style.display==='block') closeGlossary();
      if(e.key.toLowerCase()==='g' && gEl.style.display!=='block') openGlossary();
      const _cEl = document.getElementById('codeNav');
      if(e.key.toLowerCase()==='c' && _cEl && _cEl.style.display!=='block') openCodeNav();
    });
    gEl.addEventListener('click', (e)=>{ if(e.target===gEl) closeGlossary(); });
    gSearch?.addEventListener('input', renderGlossary);

    function renderGlossary(){
      const q = (gSearch?.value||'').toLowerCase();
      gBody.innerHTML = '';
      glossaryData.filter(it=>{
        if(!q) return true; const hay = (it.term+' '+it.desc+' '+(it.cat||'')).toLowerCase(); return hay.includes(q);
      }).forEach(it=>{
        const d = document.createElement('div'); d.className='term';
        d.innerHTML = `<h3>${it.term}${it.cat?` <span class="mut" style="font-size:11px">[${it.cat}]</span>`:''}</h3><p>${it.desc}</p>`;
        if(it.node){ d.style.cursor='pointer'; d.title='ã‚¯ãƒªãƒƒã‚¯ã—ã¦å›³ã®ãƒãƒ¼ãƒ‰ã‚’å¼·èª¿'; d.addEventListener('click',()=>{ highlightNode(it.node); closeGlossary(); }); }
        gBody.appendChild(d);
      });
    }

    // ãƒãƒ¼ãƒ‰å¼·èª¿è¡¨ç¤º
    let hi={id:null,t:0};
    function highlightNode(id){ hi={id,t:1.8}; const n=nodeMap.get(id); if(n){ window.scrollTo({top:0,behavior:'smooth'}); } }

    // ============= ã‚³ãƒ¼ãƒ‰ãƒŠãƒ“ =============
    const cEl = document.getElementById('codeNav');
    const cBody = document.getElementById('cBody');
    const cClose = document.getElementById('cClose');
    const codeMapData = [
      { name:'Home Mixer / Product Mixer', readme:'../home-mixer/README.md', gh:'home-mixer', items:[
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/for_you/ForYouProductPipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/for_you/ForYouScoredTweetsMixerPipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/for_you/ForYouScoredTweetsCandidatePipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/scored_tweets/ScoredTweetsRecommendationPipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/scored_tweets/candidate_pipeline/ScoredTweetsInNetworkCandidatePipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/scored_tweets/candidate_pipeline/ScoredTweetsTweetMixerCandidatePipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/scored_tweets/candidate_pipeline/ScoredTweetsUtegCandidatePipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/scored_tweets/candidate_pipeline/ScoredTweetsFrsCandidatePipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/scored_tweets/scoring_pipeline/ScoredTweetsModelScoringPipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/following/FollowingProductPipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/following/FollowingMixerPipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/following/FollowingEarlybirdCandidatePipelineConfig.scala',
        'home-mixer/server/src/main/scala/com/twitter/home_mixer/product/list_tweets/ListTweetsProductPipelineConfig.scala'
      ]},
      { name:'Timeline Ranker', readme:'../timelineranker/README.md', gh:'timelineranker', items:[] },
      { name:'CR-Mixer', readme:'../cr-mixer/README.md', gh:'cr-mixer', items:[] },
      { name:'User Signal Service (USS) / UUA', readme:'../user-signal-service/README.md', gh:'user-signal-service', items:['../unified_user_actions/README.md'] },
      { name:'Graph Feature Service', readme:'../graph-feature-service/README.md', gh:'graph-feature-service', items:[] },
      { name:'Representation Manager / Scorer', readme:'../representation-manager/README.md', gh:'representation-manager', items:['../representation-scorer/README.md'] },
      { name:'UTEG / UTG', readme:'../src/scala/com/twitter/recos/user_tweet_entity_graph/README.md', gh:'src/scala/com/twitter/recos', items:['../src/scala/com/twitter/recos/user_tweet_graph/README.md'] },
      { name:'SimClusters ANN', readme:'../simclusters-ann/README.md', gh:'simclusters-ann', items:[] },
      { name:'Follow Recommendations Service (FRS)', readme:'../follow-recommendations-service/README.md', gh:'follow-recommendations-service', items:[] },
      { name:'Topic Social Proof', readme:'../topic-social-proof/README.md', gh:'topic-social-proof', items:[] },
      { name:'Visibility Library', readme:'../visibilitylib/README.md', gh:'visibilitylib', items:[] },
      { name:'Signals (ä¸€è¦§)', readme:'../RETREIVAL_SIGNALS.md', gh:'RETREIVAL_SIGNALS.md', items:[] }
    ];

    function openCodeNav(){ cEl.style.display='block'; renderCodeNav(); }
    function closeCodeNav(){ cEl.style.display='none'; }
    cClose?.addEventListener('click', closeCodeNav);
    cEl.addEventListener('click', (e)=>{ if(e.target===cEl) closeCodeNav(); });

    function renderCodeNav(){
      cBody.innerHTML='';
      for(const m of codeMapData){
        const d = document.createElement('div'); d.className='mod';
        const ghLink = `https://github.com/kazuph/the-algorithm/tree/main/${m.gh}`;
        const local = m.readme ? `<a href="${m.readme}" target="_blank" rel="noopener">READMEï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰â†—ï¸</a>` : '';
        const remote = m.gh ? ` / <a href="${ghLink}" target="_blank" rel="noopener">GitHub â†—ï¸</a>` : '';
        d.innerHTML = `<h3>${m.name} <span class=\"mut\" style=\"font-weight:normal\">${local}${remote}</span></h3>`;
        if(m.items && m.items.length){
          const ul = document.createElement('ul');
          for(const p of m.items){
            const li = document.createElement('li');
            li.innerHTML = `<code>${p}</code> <button class=\"btn\" data-copy=\"${p}\" style=\"padding:2px 6px\">copy</button>`;
            ul.appendChild(li);
          }
          d.appendChild(ul);
        }
        cBody.appendChild(d);
      }
      cBody.querySelectorAll('[data-copy]')?.forEach(btn=>{
        btn.addEventListener('click', async (e)=>{
          const txt = e.currentTarget.getAttribute('data-copy');
          try{ await navigator.clipboard.writeText(txt); e.currentTarget.textContent='copied'; setTimeout(()=>e.currentTarget.textContent='copy',800);}catch(_){/* noop */}
        });
      });
    }
    </script>
  </body>
</html>
